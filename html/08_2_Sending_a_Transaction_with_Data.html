<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>08_2_Sending_a_Transaction_with_Data</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<h1 id="sending-a-transaction-with-data">8.2: Sending a Transaction with
Data</h1>
<p>The final way to vary how you send a basic transaction is to use the
transaction to send data instead of funds (or really, in addition to
funds). This gives you the ability to embed information in the
blockchain. It is done through a special <code>OP_RETURN</code>
command.</p>
<p>The catch? You can only store 80 bytes at a time!</p>
<h2 id="create-your-data">Create Your Data</h2>
<p>The first thing you need to do is create the 80 bytes (or less) of
data that you’ll be recording in your <code>OP_RETURN</code>. This might
be as simple as preparing a message or you might be hashing existing
data. For example, <code>sha256sum</code> produces 256 bits of data,
which is 32 bytes, well under the limits:</p>
<pre><code>$ sha256sum contract.jpg
b9f81a8919e5aba39aeb86145c684010e6e559b580a85003ae25d78237a12e75  contract.jpg
$ op_return_data=&quot;b9f81a8919e5aba39aeb86145c684010e6e559b580a85003ae25d78237a12e75&quot;</code></pre>
<blockquote>
<p>:book: <em>What is an OP_RETURN?</em> All Bitcoin transactions are
built upon opcode scripts that we’ll meet in the next chapter. The
<code>OP_RETURN</code> is a simple opcode that defines an OUTPUT as
invalid. Convention has resulted in it being used to embed data on the
blockchain.</p>
</blockquote>
<h2 id="prepare-some-money">Prepare Some Money</h2>
<p>Your purpose in creating a data transaction isn’t to send money to
anyone, it’s to put data into the blockchain. However, you <em>must</em>
send money to do so. You just need to use a change address as your
<em>only</em> recipient. Then you can identify a UTXO and send that to
your change address, minus a transaction fee, while also using the same
transaction to create an OP_RETURN.</p>
<p>Here’s the standard setup:</p>
<pre><code>$ bitcoin-cli listunspent
[
  {
    &quot;txid&quot;: &quot;854a833b667049ac811b4cf1cad40fa7f8dce8b0f4c1018a58b84559b6e05f42&quot;,
    &quot;vout&quot;: 0,
    &quot;address&quot;: &quot;tb1q6kgsjxuqwj3rwhkenpdfcjccalk06st9z0k0kh&quot;,
    &quot;scriptPubKey&quot;: &quot;0014d591091b8074a2375ed9985a9c4b18efecfd4165&quot;,
    &quot;amount&quot;: 0.01463400,
    &quot;confirmations&quot;: 1392,
    &quot;spendable&quot;: true,
    &quot;solvable&quot;: true,
    &quot;desc&quot;: &quot;wpkh([d6043800/0&#39;/1&#39;/12&#39;]02883bb5463e37d55252d8b3d5c2141b007b37c8a7db6211f75c955acc5ea325eb)#cjr03mru&quot;,
    &quot;safe&quot;: true
  }
]

$ utxo_txid=$(bitcoin-cli listunspent | jq -r &#39;.[0] | .txid&#39;)
$ utxo_vout=$(bitcoin-cli listunspent | jq -r &#39;.[0] | .vout&#39;)
$ changeaddress=$(bitcoin-cli getrawchangeaddress)</code></pre>
<h2 id="write-a-raw-transaction">Write A Raw Transaction</h2>
<p>You can now write a new rawtransaction with two outputs: one is your
change address to get back (most of) your money, the other is a data
address, which is the <code>bitcoin-cli</code> term for an
OP_RETURN.</p>
<pre><code>rawtxhex=$(bitcoin-cli -named createrawtransaction inputs=&#39;&#39;&#39;[ { &quot;txid&quot;: &quot;&#39;$utxo_txid&#39;&quot;, &quot;vout&quot;: &#39;$utxo_vout&#39; } ]&#39;&#39;&#39; outputs=&#39;&#39;&#39;{ &quot;data&quot;: &quot;&#39;$op_return_data&#39;&quot;, &quot;&#39;$changeaddress&#39;&quot;: 0.0146 }&#39;&#39;&#39;)</code></pre>
<p>Here’s what that transaction actually looks like:</p>
<pre><code>{
  &quot;txid&quot;: &quot;a600148ac3b05f0c774b8687a71c545077ea5dfb9677e5c6d708215053d892e8&quot;,
  &quot;hash&quot;: &quot;a600148ac3b05f0c774b8687a71c545077ea5dfb9677e5c6d708215053d892e8&quot;,
  &quot;version&quot;: 2,
  &quot;size&quot;: 125,
  &quot;vsize&quot;: 125,
  &quot;weight&quot;: 500,
  &quot;locktime&quot;: 0,
  &quot;vin&quot;: [
    {
      &quot;txid&quot;: &quot;854a833b667049ac811b4cf1cad40fa7f8dce8b0f4c1018a58b84559b6e05f42&quot;,
      &quot;vout&quot;: 0,
      &quot;scriptSig&quot;: {
        &quot;asm&quot;: &quot;&quot;,
        &quot;hex&quot;: &quot;&quot;
      },
      &quot;sequence&quot;: 4294967295
    }
  ],
  &quot;vout&quot;: [
    {
      &quot;value&quot;: 0.00000000,
      &quot;n&quot;: 0,
      &quot;scriptPubKey&quot;: {
        &quot;asm&quot;: &quot;OP_RETURN b9f81a8919e5aba39aeb86145c684010e6e559b580a85003ae25d78237a12e75&quot;,
        &quot;hex&quot;: &quot;6a20b9f81a8919e5aba39aeb86145c684010e6e559b580a85003ae25d78237a12e75&quot;,
        &quot;type&quot;: &quot;nulldata&quot;
      }
    },
    {
      &quot;value&quot;: 0.01460000,
      &quot;n&quot;: 1,
      &quot;scriptPubKey&quot;: {
        &quot;asm&quot;: &quot;0 998a9b0ed076bbdec1d88da4f475b9dde75e3620&quot;,
        &quot;hex&quot;: &quot;0014998a9b0ed076bbdec1d88da4f475b9dde75e3620&quot;,
        &quot;reqSigs&quot;: 1,
        &quot;type&quot;: &quot;witness_v0_keyhash&quot;,
        &quot;addresses&quot;: [
          &quot;tb1qnx9fkrksw6aaaswc3kj0gademhn4ud3q7cz4fm&quot;
        ]
      }
    }
  ]
}
</code></pre>
<p>As you can see, this sends the majority of the money straight back to
the change address
(<code>tb1qnx9fkrksw6aaaswc3kj0gademhn4ud3q7cz4fm</code>) minus a small
transaction fee. More importantly, the first output shows an OP_RETURN
with the data
(<code>b9f81a8919e5aba39aeb86145c684010e6e559b580a85003ae25d78237a12e75</code>)
right after it.</p>
<h2 id="send-a-raw-transaction">Send A Raw Transaction</h2>
<p>Sign your raw transaction and send it, and soon that OP_RETURN will
be embedded in the blockchain!</p>
<h2 id="check-your-op_return">Check Your OP_RETURN</h2>
<p>Again, remember that you can look at this transaction using a
blockchain explorer: <a
href="https://live.blockcypher.com/btc-testnet/tx/a600148ac3b05f0c774b8687a71c545077ea5dfb9677e5c6d708215053d892e8/">https://live.blockcypher.com/btc-testnet/tx/a600148ac3b05f0c774b8687a71c545077ea5dfb9677e5c6d708215053d892e8/</a></p>
<p>You may note a warning about the data being in an “unknown protocol”.
If you were designing some regular use of <code>OP_RETURN</code> data,
you’d probably mark it with a special prefix, to mark that protocol.
Then, the actual OP_RETURN data might be something like
“CONTRACTS3b110a164aa18d3a5ab064ba93fdce62”. This example didn’t use a
prefix to avoid muddying the data space.</p>
<h2 id="summary-sending-a-transaction-with-data">Summary: Sending a
Transaction with Data</h2>
<p>You can use an <code>OP_RETURN</code> opcode to store up to 80 bytes
of data on the blockchain. You do this with the <code>data</code>
codeword for a <code>vout</code>. You still have to send money along
too, but you just send it back to a change address, minus a transaction
fee.</p>
<blockquote>
<p>:fire: <em>What is the Power of OP_RETURN?</em> The OP_RETURN opens
up whole new possibilities for the blockchain, because you can embed
data that proves that certain things happened at certain times. Various
organizations have used OP_RETURNs for proof of existence, for
copyright, for colored coins, and <a
href="https://en.bitcoin.it/wiki/OP_RETURN">for other purposes</a>.
Though 80 bytes might not seem a lot, it can be quite effective if
OP_RETURNs are used to store hashes of the actual data. Then, you can
prove the existence of your digital data by demonstrating that the hash
of it matches the hash on the blockchain.</p>
</blockquote>
<p>Note that there is some controversy over using the Bitcoin blockchain
in this way.</p>
<h2 id="whats-next">What’s Next?</h2>
<p>Move on to “Bitcoin Scripting” with <a
href="09_0_Introducing_Bitcoin_Scripts.md">Chapter Nine: Introducing
Bitcoin Scripts</a>.</p>
</body>
</html>
