<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>19_2__Interlude_Accessing_a_Second_Lightning_Node</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<h1 id="interlude-accessing-a-second-lightning-node">Interlude:
Accessing a Second Lightning Node</h1>
<blockquote>
<p>:information_source: <strong>NOTE:</strong> This section has been
recently added to the course and is an early draft that may still be
awaiting review. Caveat reader.</p>
</blockquote>
<p>When you played with Bitcoin you were accessing an existing network,
and that made it relatively easy to work with: you just turned on
<code>bitcoind</code> and you were immediately interacting with the
network. That’s now how Lightning works: it’s fundamentally a
peer-to-peer network, built up from the connections between any two
individual nodes. In other words, to interact with the Lightning
Network, you’ll need to first find a node to connect to.</p>
<p>There are four ways to do so (the first three of which are possible
for your first connection):</p>
<h2 id="ask-for-information-on-a-node">Ask for Information on a
Node</h2>
<p>If someone else already has a Lightning node on the network of your
choice, just ask them for their ID.</p>
<p>If they are are running c-lightning, they just need to use the
<code>getinfo</code> command:</p>
<pre><code>$ lightning-cli getinfo
lightning-cli: WARNING: default network changing in 2020: please set network=testnet in config!
   &quot;id&quot;: &quot;03240a4878a9a64aea6c3921a434e573845267b86e89ab19003b0c910a86d17687&quot;,
   &quot;alias&quot;: &quot;VIOLETGLEE&quot;,
   &quot;color&quot;: &quot;03240a&quot;,
   &quot;num_peers&quot;: 0,
   &quot;num_pending_channels&quot;: 0,
   &quot;num_active_channels&quot;: 0,
   &quot;num_inactive_channels&quot;: 0,
   &quot;address&quot;: [
      {
         &quot;type&quot;: &quot;ipv4&quot;,
         &quot;address&quot;: &quot;74.207.240.32&quot;,
         &quot;port&quot;: 9735
      }
   ],
   &quot;binding&quot;: [
      {
         &quot;type&quot;: &quot;ipv6&quot;,
         &quot;address&quot;: &quot;::&quot;,
         &quot;port&quot;: 9735
      },
      {
         &quot;type&quot;: &quot;ipv4&quot;,
         &quot;address&quot;: &quot;0.0.0.0&quot;,
         &quot;port&quot;: 9735
      }
   ],
   &quot;version&quot;: &quot;v0.9.1-96-g6f870df&quot;,
   &quot;blockheight&quot;: 1862854,
   &quot;network&quot;: &quot;testnet&quot;,
   &quot;msatoshi_fees_collected&quot;: 0,
   &quot;fees_collected_msat&quot;: &quot;0msat&quot;,
   &quot;lightning-dir&quot;: &quot;/home/standup/.lightning/testnet&quot;
}</code></pre>
<p>They can then tell you their <code>id</code>
(<code>03240a4878a9a64aea6c3921a434e573845267b86e89ab19003b0c910a86d17687</code>).
They will also need to tell you their IP address
(<code>74.207.240.32</code>) and port (<code>9735</code>).</p>
<h2 id="create-a-new-c-lightning-node">Create a New c-lightning
Node</h2>
<p>However, for testing purposes, you probably want to have a second
node under you own control. The easiest way to do so is to create a
second c-lightning node on a new machine, using either Bitcoin Standup,
per <a
href="02_1_Setting_Up_a_Bitcoin-Core_VPS_with_StackScript.md">§2.1</a>
or compiling it by hand, per <a
href="19_1_Verifying_Your_Lightning_Setup.md">§19.1</a>.</p>
<p>Once you have your node running, you can run <code>getinfo</code> to
retrieve your information, as shown above.</p>
<h2 id="create-a-new-lnd-node">Create a New LND Node</h2>
<p>However, for our examples in the next chapter, we’re instead going to
create an LND node. This will allow us to demonstrate a bit of the depth
of the Lightning ecosystem by showing how similar commands work on the
two different platforms.</p>
<p>One way to create an LND node is to run the Bitcoin Standup Scripts
again on a new machine, but this time to choose LND, per <a
href="2_1_Setting_Up_a_Bitcoin-Core_VPS_with_StackScript.md">§2.1</a>.</p>
<p>Another is to compile LND from source code on a machine where you’rea
already running a Bitcoin node, as follows.</p>
<h3 id="compile-the-lnd-source-code">Compile the LND Source Code</h3>
<p>First, you need to download and install Go:</p>
<pre><code>$ wget --progress=bar:force https://dl.google.com/go/&quot;go1.14.4&quot;.&quot;linux&quot;-&quot;amd64&quot;.tar.gz -O ~standup/&quot;go1.14.4&quot;.&quot;linux&quot;-&quot;amd64&quot;.tar.gz
$ /bin/tar xzf ~standup/&quot;go1.14.4&quot;.&quot;linux&quot;-&quot;amd64&quot;.tar.gz -C ~standup
$ sudo mv ~standup/go /usr/local</code></pre>
<p>Be sure that the Go version is the most up to date (it’s
<code>go1.14.4</code> at the current time), and the platform and
architecture are right for your machine. (The above will work for
Debian.)</p>
<p>Update your path:</p>
<pre><code>$ export GOPATH=~standup/gocode
$ export PATH=&quot;$PATH&quot;:/usr/local/go/bin:&quot;$GOPATH&quot;/bin</code></pre>
<p>Then be sure that <code>go</code> works:</p>
<pre><code>$ go version
go version go1.14.4 linux/amd64</code></pre>
<p>You’ll also need <code>git</code> and <code>make</code>:</p>
<pre><code>$ sudo apt-get install git
$ sudo apt-get install build-essential</code></pre>
<p>You’re now ready to retrieve LND. Be sure to get the current verison
(currently <code>v0.11.0-beta.rc4</code>).</p>
<pre><code>$ go get -d github.com/lightningnetwork/lnd</code></pre>
<p>And now you can compile:</p>
<pre><code>$ cd &quot;$GOPATH&quot;/src/github.com/lightningnetwork/lnd
$ git checkout v0.11.0-beta.rc4
$ make
$ make install</code></pre>
<p>This will install to <code>~/gocode/bin</code>, which is
<code>$GOPATH/bin</code>.</p>
<p>You should move it to global directories:</p>
<pre><code>$ sudo cp $GOPATH/bin/lnd $GOPATH/bin/lncli /usr/bin</code></pre>
<h3 id="create-an-lnd-config-file">Create an LND Config File</h3>
<p>Unlike with c-lightning, you will need to create a default config
file for LND.</p>
<p>However first, you need to enable ZMQ on your Bitcoind, if you didn’t
already in <a
href="16_3_Receiving_Bitcoind_Notifications_with_C.md">§16.3</a>.</p>
<p>This requires adding the following to your
<code>~/.bitcoin/bitcoin.conf</code> file if it’s not already there:</p>
<pre><code>zmqpubrawblock=tcp://127.0.0.1:28332
zmqpubrawtx=tcp://127.0.0.1:28333</code></pre>
<p>If you’re using a Bitcoin config file from Standup or some other
specialized <code>conf</code>, be sure you’re putting your new commands
in the correct section. Ideally, they should go near the top of the
file, otherwise in the <code>[test]</code> section (assuming, as usual,
that you’re testing on testnet).</p>
<p>You must then restart bitcoin (or just reboot your machine). You can
test that it’s working as follows:</p>
<pre><code>$ bitcoin-cli getzmqnotifications
[
  {
    &quot;type&quot;: &quot;pubrawblock&quot;,
    &quot;address&quot;: &quot;tcp://127.0.0.1:28332&quot;,
    &quot;hwm&quot;: 1000
  },
  {
    &quot;type&quot;: &quot;pubrawtx&quot;,
    &quot;address&quot;: &quot;tcp://127.0.0.1:28333&quot;,
    &quot;hwm&quot;: 1000
  }
]</code></pre>
<p>Now you’re ready to create a config file.</p>
<p>First, you need to retrieve your rpcuser and rpcpassword. Here’s an
automated way to do so:</p>
<pre><code>$ BITCOINRPC_USER=$(cat ~standup/.bitcoin/bitcoin.conf | grep rpcuser | awk -F = &#39;{print $2}&#39;)
$ BITCOINRPC_PASS=$(cat ~standup/.bitcoin/bitcoin.conf | grep rpcpassword | awk -F = &#39;{print $2}&#39;)</code></pre>
<blockquote>
<p>:warning: <strong>WARNING:</strong> Obviously, never store your RPC
password in a shell variable in a production environment.</p>
</blockquote>
<p>Then, you can write the file:</p>
<pre><code>$ mkdir ~/.lnd
$ cat &gt; ~/.lnd/lnd.conf &lt;&lt; EOF
[Application Options]
maxlogfiles=3
maxlogfilesize=10
#externalip=1.1.1.1 # change to your public IP address if required.
alias=StandUp
listen=0.0.0.0:9735
debuglevel=debug
[Bitcoin]
bitcoin.active=1
bitcoin.node=bitcoind
bitcoin.testnet=true
[Bitcoind]
bitcoind.rpchost=localhost
bitcoind.rpcuser=$BITCOINRPC_USER
bitcoind.rpcpass=$BITCOINRPC_PASS
bitcoind.zmqpubrawblock=tcp://127.0.0.1:28332
bitcoind.zmqpubrawtx=tcp://127.0.0.1:28333
EOF</code></pre>
<h3 id="create-an-lnd-service">Create an LND Service</h3>
<p>Finally, you can create an LND service to automatically run
<code>lnd</code>:</p>
<pre><code>$ cat &gt; ~/lnd.service &lt;&lt; EOF
# It is not recommended to modify this file in-place, because it will
# be overwritten during package upgrades. If you want to add further
# options or overwrite existing ones then use
# $ systemctl edit lnd.service
# See &quot;man systemd.service&quot; for details.
# Note that almost all daemon options could be specified in
# /etc/lnd/lnd.conf, except for those explicitly specified as arguments
# in ExecStart=
[Unit]
Description=LND Lightning Network Daemon
Requires=bitcoind.service
After=bitcoind.service
[Service]
ExecStart=/usr/bin/lnd
ExecStop=/usr/bin/lncli --lnddir /var/lib/lnd stop
PIDFile=/run/lnd/lnd.pid
User=standup
Type=simple
KillMode=process
TimeoutStartSec=60
TimeoutStopSec=60
Restart=always
RestartSec=60
[Install]
WantedBy=multi-user.target
EOF</code></pre>
<p>You’ll then need to install that and start things up:</p>
<pre><code>$ sudo cp ~/lnd.service /etc/systemd/system
$ sudo systemctl enable lnd
$ sudo systemctl start lnd</code></pre>
<p>(Expect this to take a minute the first time.)</p>
<h3 id="enable-remote-connections">Enable Remote Connections</h3>
<p>Just as with c-lightning, you’re going to need to make LND accessible
to other nodes. Here’s how to do so if you use <code>ufw</code>, as per
the Bitcoin Standup setups:</p>
<pre><code>$ sudo ufw allow 9735</code></pre>
<h3 id="create-a-wallet">Create a Wallet</h3>
<p>The first time you run LND, you must create a wallet:</p>
<pre><code>$ lncli --network=testnet create</code></pre>
<p>LND will ask you for a password and then ask if you want to enter an
existing mnemonic (just hit <code>n</code> for the latter one).</p>
<p>You should now have a functioning <code>lnd</code>, which you can
verify with <code>getinfo</code>:</p>
<pre><code>$ lncli --network=testnet getinfo
{
    &quot;version&quot;: &quot;0.11.0-beta.rc4 commit=v0.11.0-beta.rc4&quot;,
    &quot;commit_hash&quot;: &quot;fc12656a1a62e5d69430bba6e4feb8cfbaf21542&quot;,
    &quot;identity_pubkey&quot;: &quot;032a7572dc013b6382cde391d79f292ced27305aa4162ec3906279fc4334602543&quot;,
    &quot;alias&quot;: &quot;StandUp&quot;,
    &quot;color&quot;: &quot;#3399ff&quot;,
    &quot;num_pending_channels&quot;: 0,
    &quot;num_active_channels&quot;: 0,
    &quot;num_inactive_channels&quot;: 0,
    &quot;num_peers&quot;: 2,
    &quot;block_height&quot;: 1862848,
    &quot;block_hash&quot;: &quot;000000000000000ecb6fd95e1f486283d48683aa3111b6c23144a2056f5a1532&quot;,
    &quot;best_header_timestamp&quot;: &quot;1602632294&quot;,
    &quot;synced_to_chain&quot;: true,
    &quot;synced_to_graph&quot;: false,
    &quot;testnet&quot;: true,
    &quot;chains&quot;: [
        {
            &quot;chain&quot;: &quot;bitcoin&quot;,
            &quot;network&quot;: &quot;testnet&quot;
        }
    ],
    &quot;uris&quot;: [
    ],
    &quot;features&quot;: {
        &quot;0&quot;: {
            &quot;name&quot;: &quot;data-loss-protect&quot;,
            &quot;is_required&quot;: true,
            &quot;is_known&quot;: true
        },
        &quot;5&quot;: {
            &quot;name&quot;: &quot;upfront-shutdown-script&quot;,
            &quot;is_required&quot;: false,
            &quot;is_known&quot;: true
        },
        &quot;7&quot;: {
            &quot;name&quot;: &quot;gossip-queries&quot;,
            &quot;is_required&quot;: false,
            &quot;is_known&quot;: true
        },
        &quot;9&quot;: {
            &quot;name&quot;: &quot;tlv-onion&quot;,
            &quot;is_required&quot;: false,
            &quot;is_known&quot;: true
        },
        &quot;13&quot;: {
            &quot;name&quot;: &quot;static-remote-key&quot;,
            &quot;is_required&quot;: false,
            &quot;is_known&quot;: true
        },
        &quot;15&quot;: {
            &quot;name&quot;: &quot;payment-addr&quot;,
            &quot;is_required&quot;: false,
            &quot;is_known&quot;: true
        },
        &quot;17&quot;: {
            &quot;name&quot;: &quot;multi-path-payments&quot;,
            &quot;is_required&quot;: false,
            &quot;is_known&quot;: true
        }
    }
}</code></pre>
<p>This node’s ID is
<code>032a7572dc013b6382cde391d79f292ced27305aa4162ec3906279fc4334602543</code>.
Although this command doesn’t show you the IP address and port, they
should be the IP address for your machine and port
<code>9735</code>.</p>
<h2 id="listen-to-gossip">Listen to Gossip</h2>
<p>If you were already connected to the Lightning Network, and were
“gossipping” with peers, you might also be able to find information on
peers automatically, through the <code>listpeers</code> command:</p>
<pre><code>c$ lightning-cli --network=testnet listpeers
{
   &quot;peers&quot;: [
      {
         &quot;id&quot;: &quot;0302d48972ba7eef8b40696102ad114090fd4c146e381f18c7932a2a1d73566f84&quot;,
         &quot;connected&quot;: true,
         &quot;netaddr&quot;: [
            &quot;127.0.0.1:9736&quot;
         ],
         &quot;features&quot;: &quot;02a2a1&quot;,
         &quot;channels&quot;: []
      }
   ]
}</code></pre>
<p>However, that definitely won’t be the case for your first interaction
with the Lightning Network.</p>
<h2 id="summary-accessing-a-second-lightning-node">Summary: Accessing a
Second Lightning Node</h2>
<p>You always need two Lightning nodes to form a channel. If you don’t
have someone else who is testing things out with you, you’re going to
need to create a second one, either using c-lightning or (as we will in
our examples) LND.</p>
<h2 id="whats-next">What’s Next?</h2>
<p>Though you’ve possibly created an LND, c-lightning will remain the
heart of our examples until we need to start using both of them, in <a
href="19_0_Understanding_Your_Lightning_Setup.md">Chapter 19</a>.</p>
<p>Continue “Understanding Your Lightning Setup” with <a
href="19_3_Setting_Up_a_Channel.md">§19.3: Setting Up_a_Channel</a>.</p>
</body>
</html>
