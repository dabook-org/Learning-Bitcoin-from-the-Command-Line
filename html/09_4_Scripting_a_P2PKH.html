<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>09_4_Scripting_a_P2PKH</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<h1 id="scripting-a-p2pkh">9.4: Scripting a P2PKH</h1>
<p>P2PKH addresses are quickly fading in popularity due to the advent of
SegWit, but nonetheless they remain a great building block for
understanding Bitcoin, and especially for understanding Bitcoin scripts.
(We’ll take a quick look at how Segwit-native P2WPKH scripts work
differently in the next section.)</p>
<h2 id="understand-the-unlocking-script">Understand the Unlocking
Script</h2>
<p>We’ve long said that when funds are sent to a Bitcoin address,
they’re locked to the private key associated with that address. This is
managed through the <code>scriptPubKey</code> of a P2PKH transaction,
which is designed such that it requires the recipient to have the
private key associated with the the P2PKH Bitcoin address. To be
precise, the recipient must supply both the public key linked to the
private key and a signature generated by the private key.</p>
<p>Take a look again at the transaction you created in <a
href="09_1_Understanding_the_Foundation_of_Transactions.md">§9.1</a>:</p>
<pre><code>$ bitcoin-cli -named decoderawtransaction hexstring=$signedtx
{
  &quot;txid&quot;: &quot;34151dac704d94a269cd33f80be34c122152edc9bfbb9323852966bf0ce937ed&quot;,
  &quot;hash&quot;: &quot;34151dac704d94a269cd33f80be34c122152edc9bfbb9323852966bf0ce937ed&quot;,
  &quot;version&quot;: 2,
  &quot;size&quot;: 191,
  &quot;vsize&quot;: 191,
  &quot;weight&quot;: 764,
  &quot;locktime&quot;: 0,
  &quot;vin&quot;: [
    {
      &quot;txid&quot;: &quot;bb4362dec15e67d366088f5493c789f22fb4a604e767dae1f6a631687e2784aa&quot;,
      &quot;vout&quot;: 0,
      &quot;scriptSig&quot;: {
        &quot;asm&quot;: &quot;304402201cc39005b076cb06534cd084fcc522e7bf937c4c9654c1c9dfba68b92cbab7d1022066f273178febc7a37568e2e9f4dec980a2e9a95441abe838c7ef64c39d85849c[ALL] 0315a0aeb37634a71ede72d903acae4c6efa77f3423dcbcd6de3e13d9fd989438b&quot;,
        &quot;hex&quot;: &quot;47304402201cc39005b076cb06534cd084fcc522e7bf937c4c9654c1c9dfba68b92cbab7d1022066f273178febc7a37568e2e9f4dec980a2e9a95441abe838c7ef64c39d85849c01210315a0aeb37634a71ede72d903acae4c6efa77f3423dcbcd6de3e13d9fd989438b&quot;
      },
      &quot;sequence&quot;: 4294967295
    }
  ],
  &quot;vout&quot;: [
    {
      &quot;value&quot;: 0.00090000,
      &quot;n&quot;: 0,
      &quot;scriptPubKey&quot;: {
        &quot;asm&quot;: &quot;OP_DUP OP_HASH160 06b5c6ba5330cdf738a2ce91152bfd0e71f9ec39 OP_EQUALVERIFY OP_CHECKSIG&quot;,
        &quot;hex&quot;: &quot;76a91406b5c6ba5330cdf738a2ce91152bfd0e71f9ec3988ac&quot;,
        &quot;reqSigs&quot;: 1,
        &quot;type&quot;: &quot;pubkeyhash&quot;,
        &quot;addresses&quot;: [
          &quot;mg8S7F1gY3ivV9M9GrWwe6ziWvK2MFquCf&quot;
        ]
      }
    }
  ]
}</code></pre>
<p>You can see that its <code>scriptSig</code> unlocking script has two
values. That’s a <code>&lt;signature&gt;</code> (and an
<code>[ALL]</code>) and a <code>&lt;pubKey&gt;</code>:</p>
<pre><code>304402201cc39005b076cb06534cd084fcc522e7bf937c4c9654c1c9dfba68b92cbab7d1022066f273178febc7a37568e2e9f4dec980a2e9a95441abe838c7ef64c39d85849c[ALL] 0315a0aeb37634a71ede72d903acae4c6efa77f3423dcbcd6de3e13d9fd989438b</code></pre>
<p>That’s all an unlock script is! (For a P2PKH.)</p>
<h2 id="understand-the-locking-script">Understand the Locking
Script</h2>
<p>Remember that each unlocking script unlocks a previous UTXO. In the
above example, the <code>vin</code> reveals that it’s actually unlocking
vout <code>0</code> of txid
<code>bb4362dec15e67d366088f5493c789f22fb4a604e767dae1f6a631687e2784aa</code>.</p>
<p>You can examine that UTXO with <code>gettransaction</code>.</p>
<pre><code>$ bitcoin-cli gettransaction &quot;bb4362dec15e67d366088f5493c789f22fb4a604e767dae1f6a631687e2784aa&quot;
{
  &quot;amount&quot;: 0.00095000,
  &quot;confirmations&quot;: 12,
  &quot;blockhash&quot;: &quot;0000000075a4c1519da5e671b15064734c42784eab723530a6ace83ca1e66d3f&quot;,
  &quot;blockheight&quot;: 1780789,
  &quot;blockindex&quot;: 132,
  &quot;blocktime&quot;: 1594841768,
  &quot;txid&quot;: &quot;bb4362dec15e67d366088f5493c789f22fb4a604e767dae1f6a631687e2784aa&quot;,
  &quot;walletconflicts&quot;: [
  ],
  &quot;time&quot;: 1594841108,
  &quot;timereceived&quot;: 1594841108,
  &quot;bip125-replaceable&quot;: &quot;no&quot;,
  &quot;details&quot;: [
    {
      &quot;address&quot;: &quot;mmX7GUoXq2wVcbnrnFJrGKsGR14fXiGbD9&quot;,
      &quot;category&quot;: &quot;receive&quot;,
      &quot;amount&quot;: 0.00095000,
      &quot;label&quot;: &quot;&quot;,
      &quot;vout&quot;: 0
    }
  ],
  &quot;hex&quot;: &quot;020000000001011efcc3bf9950ac2ea08c53b43a0f8cc21e4b5564e205f996f7cadb7d13bb79470000000017160014c4ea10874ae77d957e170bd43f2ee828a8e3bc71feffffff0218730100000000001976a91441d83eaffbf80f82dee4c152de59a38ffd0b602188ac713b10000000000017a914b780fc2e945bea71b9ee2d8d2901f00914a25fbd8702473044022025ee4fd38e6865125f7c315406c0b3a8139d482e3be333727d38868baa656d3d02204b35d9b5812cb85894541da611d5cec14c374ae7a7b8ba14bb44495747b571530121033cae26cb3fa063c95e2c55a94bd04ab9cf173104555efe448b1bfc3a68c8f873342c1b00&quot;
}</code></pre>
<p>But as you can see, you didn’t get the <code>scriptPubKey</code> with
<code>gettransaction</code>. You need to take an additional step to
retrieve that by examining the raw transaction info (that’s the
<code>hex</code>) with <code>decoderawtransaction</code>:</p>
<pre><code>$ hex=$(bitcoin-cli gettransaction &quot;bb4362dec15e67d366088f5493c789f22fb4a604e767dae1f6a631687e2784aa&quot; | jq -r &#39;.hex&#39;)
$ bitcoin-cli decoderawtransaction $hex
{
  &quot;txid&quot;: &quot;bb4362dec15e67d366088f5493c789f22fb4a604e767dae1f6a631687e2784aa&quot;,
  &quot;hash&quot;: &quot;6866490b16a92d68179e1cf04380fd08f16ec80bf66469af8d5e78ae624ff202&quot;,
  &quot;version&quot;: 2,
  &quot;size&quot;: 249,
  &quot;vsize&quot;: 168,
  &quot;weight&quot;: 669,
  &quot;locktime&quot;: 1780788,
  &quot;vin&quot;: [
    {
      &quot;txid&quot;: &quot;4779bb137ddbcaf796f905e264554b1ec28c0f3ab4538ca02eac5099bfc3fc1e&quot;,
      &quot;vout&quot;: 0,
      &quot;scriptSig&quot;: {
        &quot;asm&quot;: &quot;0014c4ea10874ae77d957e170bd43f2ee828a8e3bc71&quot;,
        &quot;hex&quot;: &quot;160014c4ea10874ae77d957e170bd43f2ee828a8e3bc71&quot;
      },
      &quot;txinwitness&quot;: [
        &quot;3044022025ee4fd38e6865125f7c315406c0b3a8139d482e3be333727d38868baa656d3d02204b35d9b5812cb85894541da611d5cec14c374ae7a7b8ba14bb44495747b5715301&quot;,
        &quot;033cae26cb3fa063c95e2c55a94bd04ab9cf173104555efe448b1bfc3a68c8f873&quot;
      ],
      &quot;sequence&quot;: 4294967294
    }
  ],
  &quot;vout&quot;: [
    {
      &quot;value&quot;: 0.00095000,
      &quot;n&quot;: 0,
      &quot;scriptPubKey&quot;: {
        &quot;asm&quot;: &quot;OP_DUP OP_HASH160 41d83eaffbf80f82dee4c152de59a38ffd0b6021 OP_EQUALVERIFY OP_CHECKSIG&quot;,
        &quot;hex&quot;: &quot;76a91441d83eaffbf80f82dee4c152de59a38ffd0b602188ac&quot;,
        &quot;reqSigs&quot;: 1,
        &quot;type&quot;: &quot;pubkeyhash&quot;,
        &quot;addresses&quot;: [
          &quot;mmX7GUoXq2wVcbnrnFJrGKsGR14fXiGbD9&quot;
        ]
      }
    },
    {
      &quot;value&quot;: 0.01063793,
      &quot;n&quot;: 1,
      &quot;scriptPubKey&quot;: {
        &quot;asm&quot;: &quot;OP_HASH160 b780fc2e945bea71b9ee2d8d2901f00914a25fbd OP_EQUAL&quot;,
        &quot;hex&quot;: &quot;a914b780fc2e945bea71b9ee2d8d2901f00914a25fbd87&quot;,
        &quot;reqSigs&quot;: 1,
        &quot;type&quot;: &quot;scripthash&quot;,
        &quot;addresses&quot;: [
          &quot;2N9yWARt5E3TQsX2RjsauxSZaEZVhinAS4h&quot;
        ]
      }
    }
  ]
}</code></pre>
<p>You can now look at <code>vout</code> <code>0</code> and see it was
locked with the <code>scriptPubKey</code> of
<code>OP_DUP OP_HASH160 41d83eaffbf80f82dee4c152de59a38ffd0b6021 OP_EQUALVERIFY OP_CHECKSIG</code>.
That’s the standard locking methodology used for an older P2PKH address
with the <code>&lt;pubKeyHash&gt;</code> stuck in the middle.</p>
<p>Running it will demonstrate how it works.</p>
<h2 id="run-a-p2pkh-script">Run a P2PKH Script</h2>
<p>When you unlock a P2PKH UTXO, you (effectively) concatenate the
unlocking and locking scripts. For a P2PKH address, like the example
used in this chapter, that produces:</p>
<pre><code>Script: &lt;signature&gt; &lt;pubKey&gt; OP_DUP OP_HASH160 &lt;pubKeyHash&gt; OP_EQUALVERIFY OP_CHECKSIG</code></pre>
<p>With that put together, you can examinine how a P2PKH UTXO is
unlocked.</p>
<p>First, you put the initial constants on the stack, then make a
duplicate of the pubKey with <code>OP_DUP</code>:</p>
<pre><code>Script: &lt;signature&gt; &lt;pubKey&gt; OP_DUP OP_HASH160 &lt;pubKeyHash&gt; OP_EQUALVERIFY OP_CHECKSIG
Stack: [ ]

Script: &lt;pubKey&gt; OP_DUP OP_HASH160 &lt;pubKeyHash&gt; OP_EQUALVERIFY OP_CHECKSIG
Stack: [ &lt;signature&gt; ]

Script: OP_DUP OP_HASH160 &lt;pubKeyHash&gt; OP_EQUALVERIFY OP_CHECKSIG
Stack: [ &lt;signature&gt; &lt;pubKey&gt; ]

Script: OP_HASH160 &lt;pubKeyHash&gt; OP_EQUALVERIFY OP_CHECKSIG
Running: &lt;pubKey&gt; OP_DUP
Stack: [ &lt;signature&gt; &lt;pubKey&gt; &lt;pubKey&gt; ]</code></pre>
<p>Why the duplicate? Because it’s needed to check the two unlocking
elements: the public key and the signature.</p>
<p>Next, <code>OP_HASH160</code> pops the <code>&lt;pubKey&gt;</code>
off the stack, hashes it, and puts the result back on the stack.</p>
<pre><code>Script: &lt;pubKeyHash&gt; OP_EQUALVERIFY OP_CHECKSIG
Running: &lt;pubKey&gt; OP_HASH160
Stack: [ &lt;signature&gt; &lt;pubKey&gt; &lt;pubKeyHash&gt; ]</code></pre>
<p>Then, you place the <code>&lt;pubKeyHash&gt;</code> that was in the
locking script on the stack:</p>
<pre><code>Script: OP_EQUALVERIFY OP_CHECKSIG
Stack: [ &lt;signature&gt; &lt;pubKey&gt; &lt;pubKeyHash&gt; &lt;pubKeyHash&gt; ]</code></pre>
<p><code>OP_EQUALVERIFY</code> is effectively two opcodes:
<code>OP_EQUAL</code>, which pops two items from the stack and pushes
<code>True</code> or <code>False</code> based on the comparison; and
<code>OP_VERIFY</code> which pops that result and immediately marks the
transaction as invalid if it’s <code>False</code>. (Chapter 12 talks
more about the use of <code>OP_VERIFY</code> as a conditional.)</p>
<p>Assuming the two <code>&lt;pubKeyHash&gt;es</code> are equal, you
will have the following result:</p>
<pre><code>Script: OP_CHECKSIG
Running: &lt;pubKeyHash&gt; &lt;pubKeyHash&gt; OP_EQUALVERIFY
Stack: [ &lt;signature&gt; &lt;pubKey&gt; ]</code></pre>
<p>At this point you’ve proven that the <code>&lt;pubKey&gt;</code>
supplied in the <code>scriptSig</code> hashes to the Bitcoin address in
question, so you know that the redeemer knew the public key. But, they
also need to prove knowledge of the private key, which is done with
<code>OP_CHECKSIG</code>, which confirms that the unlocking script’s
signature matches that public key.</p>
<pre><code>Script:
Running: &lt;signature&gt; &lt;pubKey&gt; OP_CHECKSIG
Stack: [ True ]</code></pre>
<p>The Script now ends and if it was successful, the transaction is
allowed to respend the UTXO in question.</p>
<h3 id="use-btcdeb-for-a-p2pkh-example">Use btcdeb for a P2PKH
Example</h3>
<p>Testing out actual Bitcoin transactions with <code>btcdeb</code> is a
bit trickier, because you need to know the public key and a signature to
make everything work, and generating the latter is somewhat difficult.
However, one way to test things is to let Bitcoin do the work for you in
generating a transaction that <em>would</em> unlock a UTXO. That’s what
you’ve done above: generating the transaction to spend the UTXO caused
<code>bitcoin-cli</code> to calculate the <code>&lt;signature&gt;</code>
and <code>&lt;pubKey&gt;</code>. You then look at the raw transaction
information of the UTXO to learn the locking script including the
<code>&lt;pubKeyHash&gt;</code></p>
<p>You can put together the locking script, the signature, and the
pubkey using <code>btcdeb</code>, showing how simple a P2PKH script
is.</p>
<pre><code>$ btcdeb &#39;[304402201cc39005b076cb06534cd084fcc522e7bf937c4c9654c1c9dfba68b92cbab7d1022066f273178febc7a37568e2e9f4dec980a2e9a95441abe838c7ef64c39d85849c 0315a0aeb37634a71ede72d903acae4c6efa77f3423dcbcd6de3e13d9fd989438b OP_DUP OP_HASH160 41d83eaffbf80f82dee4c152de59a38ffd0b6021 OP_EQUALVERIFY OP_CHECKSIG]&#39;
btcdeb 0.2.19 -- type `btcdeb -h` for start up options
unknown key ID 41d83eaffbf80f82dee4c152de59a38ffd0b6021: returning fake key
valid script
7 op script loaded. type `help` for usage information
script                                                             |                                                             stack 
-------------------------------------------------------------------+-------------------------------------------------------------------
304402201cc39005b076cb06534cd084fcc522e7bf937c4c9654c1c9dfba68b... | 
0315a0aeb37634a71ede72d903acae4c6efa77f3423dcbcd6de3e13d9fd989438b | 
OP_DUP                                                             |
OP_HASH160                                                         |
41d83eaffbf80f82dee4c152de59a38ffd0b6021                           | 
OP_EQUALVERIFY                                                     | 
OP_CHECKSIG                                                        | 
                                                                   | 
                                                                   | 
#0000 304402201cc39005b076cb06534cd084fcc522e7bf937c4c9654c1c9dfba68b92cbab7d1022066f273178febc7a37568e2e9f4dec980a2e9a95441abe838c7ef64c39d85849c</code></pre>
<p>You push the <code>&lt;signature&gt;</code> and
<code>&lt;pubKey&gt;</code> onto the stack:</p>
<pre><code>btcdeb&gt; step
        &lt;&gt; PUSH stack 304402201cc39005b076cb06534cd084fcc522e7bf937c4c9654c1c9dfba68b92cbab7d1022066f273178febc7a37568e2e9f4dec980a2e9a95441abe838c7ef64c39d85849c
script                                                             |                                                             stack 
-------------------------------------------------------------------+-------------------------------------------------------------------
0315a0aeb37634a71ede72d903acae4c6efa77f3423dcbcd6de3e13d9fd989438b | 304402201cc39005b076cb06534cd084fcc522e7bf937c4c9654c1c9dfba68b...
OP_DUP                                                             | 
OP_HASH160                                                         | 
41d83eaffbf80f82dee4c152de59a38ffd0b6021                           |  
OP_EQUALVERIFY                                                     |  
OP_CHECKSIG                                                        |     
                                                                   |   
                                                                   | 
                                                                   | 
                                                                   | 
                                                                   | 
#0001 0315a0aeb37634a71ede72d903acae4c6efa77f3423dcbcd6de3e13d9fd989438b
btcdeb&gt; step
        &lt;&gt; PUSH stack 0315a0aeb37634a71ede72d903acae4c6efa77f3423dcbcd6de3e13d9fd989438b
script                                                             |                                                             stack 
-------------------------------------------------------------------+-------------------------------------------------------------------
OP_DUP                                                             | 0315a0aeb37634a71ede72d903acae4c6efa77f3423dcbcd6de3e13d9fd989438b
OP_HASH160                                                         | 304402201cc39005b076cb06534cd084fcc522e7bf937c4c9654c1c9dfba68b...
41d83eaffbf80f82dee4c152de59a38ffd0b6021                           | 
OP_EQUALVERIFY                                                     |
OP_CHECKSIG                                                        |  
                                                                   |   
                                                                   |    
                                                                   | 
                                                                   |
                                                                   | 
                                                                   | 
                                                               | </code></pre>
<p>You <code>OP_DUP</code> and <code>OP_HASH</code> the
<code>&lt;pubKey&gt;</code>:</p>
<pre><code>#0002 OP_DUP
btcdeb&gt; step
        &lt;&gt; PUSH stack 0315a0aeb37634a71ede72d903acae4c6efa77f3423dcbcd6de3e13d9fd989438b
script                                                             |                                                             stack 
-------------------------------------------------------------------+-------------------------------------------------------------------
OP_HASH160                                                         | 0315a0aeb37634a71ede72d903acae4c6efa77f3423dcbcd6de3e13d9fd989438b
41d83eaffbf80f82dee4c152de59a38ffd0b6021                           | 0315a0aeb37634a71ede72d903acae4c6efa77f3423dcbcd6de3e13d9fd989438b
OP_EQUALVERIFY                                                     | 304402201cc39005b076cb06534cd084fcc522e7bf937c4c9654c1c9dfba68b...
OP_CHECKSIG                                                        | 
                                                                   | 
                                                                   |   
                                                                   |  
                                                                   |   
                                                                   |   
                                                                   | 
                                                                   | 
                                                                   |
                                                                   | 
#0003 OP_HASH160
btcdeb&gt; step
        &lt;&gt; POP  stack
        &lt;&gt; PUSH stack 41d83eaffbf80f82dee4c152de59a38ffd0b6021
script                                                             |                                                             stack 
-------------------------------------------------------------------+-------------------------------------------------------------------
41d83eaffbf80f82dee4c152de59a38ffd0b6021                           |                           41d83eaffbf80f82dee4c152de59a38ffd0b6021
OP_EQUALVERIFY                                                     | 0315a0aeb37634a71ede72d903acae4c6efa77f3423dcbcd6de3e13d9fd989438b
OP_CHECKSIG                                                        | 304402201cc39005b076cb06534cd084fcc522e7bf937c4c9654c1c9dfba68b...
                                                                   | 
                                                                   | 
                                                                   |   
                                                                   |    
                                                                   |    
                                                                   |     
                                                                   | 
                                                                   | 
                                                                   | 
                                                                   | </code></pre>
<p>You push the <code>&lt;pubKeyHash&gt;</code> from the locking script
onto the stack and verify it:</p>
<pre><code>#0004 41d83eaffbf80f82dee4c152de59a38ffd0b6021
btcdeb&gt; step
        &lt;&gt; PUSH stack 41d83eaffbf80f82dee4c152de59a38ffd0b6021
script                                                             |                                                             stack 
-------------------------------------------------------------------+-------------------------------------------------------------------
OP_EQUALVERIFY                                                     |                           41d83eaffbf80f82dee4c152de59a38ffd0b6021
OP_CHECKSIG                                                        |                           41d83eaffbf80f82dee4c152de59a38ffd0b6021
                                                                   | 0315a0aeb37634a71ede72d903acae4c6efa77f3423dcbcd6de3e13d9fd989438b
                                                                   | 304402201cc39005b076cb06534cd084fcc522e7bf937c4c9654c1c9dfba68b...
                                                                   | 
                                                                   | 
                                                                   |  
                                                                   |  
                                                                   |  
                                                                   |       
                                                                   |   
                                                                   | 
                                                                   |
                                                                   | 
#0005 OP_EQUALVERIFY
btcdeb&gt; step
        &lt;&gt; POP  stack
        &lt;&gt; POP  stack
        &lt;&gt; PUSH stack 01
        &lt;&gt; POP  stack
script                                                             |                                                             stack 
-------------------------------------------------------------------+-------------------------------------------------------------------
OP_CHECKSIG                                                        | 0315a0aeb37634a71ede72d903acae4c6efa77f3423dcbcd6de3e13d9fd989438b
                                                                   | 304402201cc39005b076cb06534cd084fcc522e7bf937c4c9654c1c9dfba68b...
                                                                   | 
                                                                   | and_v(
                                                                   |     sig(304402201cc39005b076cb06534cd084fcc522e7bf937c4c9654c1c...
                                                                   |     and_v(
                                                                   |         pk(0315a0aeb37634a71ede72d903acae4c6efa77f3423dcbcd6de3...
                                                                   |         c:pk_h(030500000000000000000000000000000000000000000000...
                                                                   |     )
                                                                   | 
                                                                   | )
                                                                   | 
            </code></pre>
<p>And that point, all that’s required is the
<code>OP_CHECKSIG</code>:</p>
<pre><code>#0006 OP_CHECKSIG
btcdeb&gt; step
error: Signature is found in scriptCode</code></pre>
<p>(Unfortunately this checking may or may not be working at any point
due to vagaries of the Bitcoin Core and <code>btcdeb</code> code.)</p>
<p>As is shown, a P2PKH is quite simple: its protection comes about
through the strength of its cryptography.</p>
<h3 id="how-to-look-up-a-pub-key-signature-by-hand">How to Look Up a Pub
Key &amp; Signature by Hand</h3>
<p>What if you wanted to generate the <code>&lt;signature&gt;</code> and
<code>&lt;PubKey&gt;</code> information needed to unlock a UTXO
yourself, without leaning on <code>bitcoin-cli</code> to create a
transaction?</p>
<p>It turns out that it’s pretty easy to get a
<code>&lt;pubKey&gt;</code> You just need to use
<code>getaddressinfo</code> to examine the address where the UTXO is
currently sitting:</p>
<pre><code>$ bitcoin-cli getaddressinfo mmX7GUoXq2wVcbnrnFJrGKsGR14fXiGbD9
{
  &quot;address&quot;: &quot;mmX7GUoXq2wVcbnrnFJrGKsGR14fXiGbD9&quot;,
  &quot;scriptPubKey&quot;: &quot;76a91441d83eaffbf80f82dee4c152de59a38ffd0b602188ac&quot;,
  &quot;ismine&quot;: true,
  &quot;solvable&quot;: true,
  &quot;desc&quot;: &quot;pkh([f004311c/0&#39;/0&#39;/2&#39;]0315a0aeb37634a71ede72d903acae4c6efa77f3423dcbcd6de3e13d9fd989438b)#t3g5mjk9&quot;,
  &quot;iswatchonly&quot;: false,
  &quot;isscript&quot;: false,
  &quot;iswitness&quot;: false,
  &quot;pubkey&quot;: &quot;0315a0aeb37634a71ede72d903acae4c6efa77f3423dcbcd6de3e13d9fd989438b&quot;,
  &quot;iscompressed&quot;: true,
  &quot;ischange&quot;: false,
  &quot;timestamp&quot;: 1594835792,
  &quot;hdkeypath&quot;: &quot;m/0&#39;/0&#39;/2&#39;&quot;,
  &quot;hdseedid&quot;: &quot;f058372260f71fea37f7ecab9e4c5dc25dc11eac&quot;,
  &quot;hdmasterfingerprint&quot;: &quot;f004311c&quot;,
  &quot;labels&quot;: [
    &quot;&quot;
  ]
}</code></pre>
<p>Figuring out that signature, however, requires really understanding
the nuts and bolts of how Bitcoin transactions are created. So we leave
that as advanced study for the reader: creating a
<code>bitcoin-cli</code> transaction to “solve” a UTXO is the best
solution to that for the moment.</p>
<h2 id="summary-scripting-a-pay-to-public-key-hash">Summary: Scripting a
Pay to Public Key Hash</h2>
<p>Sending to a P2PKH address was relatively easy when you were just
using <code>bitcoin-cli</code>. Examining the Bitcoin Script underlying
it lays bare the cryptographic functions that were implicit in funding
that transaction: how the UTXO was unlocked with a signature and a
public key.</p>
<h2 id="whats-next">What’s Next?</h2>
<p>Continue “Introducing Bitcoin Scripts” with <a
href="09_5_Scripting_a_P2WPKH.md">§9.5: Scripting a P2WPKH</a>.</p>
</body>
</html>
