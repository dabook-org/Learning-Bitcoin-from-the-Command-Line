<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>17_7_Integrating_Libwally_and_Bitcoin-CLI</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<h1 id="integrating-libwally-and-bitcoin-cli">17.7: Integrating Libwally
and Bitcoin-CLI</h1>
<blockquote>
<p>:information_source: <strong>NOTE:</strong> This section has been
recently added to the course and is an early draft that may still be
awaiting review. Caveat reader.</p>
</blockquote>
<p>Libwally is limited. It’s about manipulating seeds, keys, addresses,
and other elements of wallets, with some additional functions related to
transactions and PSBTs that might be useful for services that are not
connected to full nodes on the internet. Ultimately, however, you’re
going to need full node services to take advantage of Libwally.</p>
<p>This final section will offer some examples of using Libwally
programs to complement a <code>bitcoin-cli</code> environment. Though
these examples imply that these services are all on the same machine,
they may become even more powerful if the <code>bitcoin-cli</code>
service is directly connected to the internet and the Libwally service
is not.</p>
<h2 id="share-a-transaction">Share a Transaction</h2>
<p><a href="17_5_Using_Scripts_in_Libwally.md">§17.5: Using Scripts in
Libwally</a> detailed how Libwally could be used to rewrite an existing
transaction, to do something that <code>bitcoin-cli</code> can’t:
produce a transaction that contains a unique P2SH. Obviously, this is a
building block; if you decide to dig further into Libwally you’ll create
entire transactions on your own. But, this abbreviated methodology also
has its own usage: it shows how transactions can be passed back and
forth between <code>bitcoin-cli</code> and Libwally, demonstrating a
first example of using them in a complementary fashion.</p>
<p>To fully demonstrate this methodology, you’ll create a transaction
with <code>bitcoin-cli</code>, using this UTXO:</p>
<pre><code>  {
    &quot;txid&quot;: &quot;c0a110a7a84399b98052c6545018873b13ee3128fa74f7a697779174a36ea33a&quot;,
    &quot;vout&quot;: 1,
    &quot;address&quot;: &quot;mvLyH7Rs45c16FG2dfV7uuTKV6pL92kWxo&quot;,
    &quot;label&quot;: &quot;&quot;,
    &quot;scriptPubKey&quot;: &quot;76a914a2a68c5f9b8e25fdd1213c38d952ab2be2e271be88ac&quot;,
    &quot;amount&quot;: 0.00094000,
    &quot;confirmations&quot;: 17375,
    &quot;spendable&quot;: true,
    &quot;solvable&quot;: true,
    &quot;desc&quot;: &quot;pkh([ce0c7e14/0&#39;/0&#39;/5&#39;]0368d0fffa651783524f8b934d24d03b32bf8ff2c0808943a556b3d74b2e5c7d65)#qldtsl65&quot;,
    &quot;safe&quot;: true
  }</code></pre>
<p>By now, you know how to set up a transaction with
<code>bitcoin-cli</code>:</p>
<pre><code>$ utxo_txid=$(bitcoin-cli listunspent | jq -r &#39;.[0] | .txid&#39;) 
$ utxo_vout=$(bitcoin-cli listunspent | jq -r &#39;.[0] | .vout&#39;)
$ recipient=tb1qycsmq3jas5wkhf8xrfn8k7438cm5pc8h9ae2k0
$ rawtxhex=$(bitcoin-cli -named createrawtransaction inputs=&#39;&#39;&#39;[ { &quot;txid&quot;: &quot;&#39;$utxo_txid&#39;&quot;, &quot;vout&quot;: &#39;$utxo_vout&#39; } ]&#39;&#39;&#39; outputs=&#39;&#39;&#39;{ &quot;&#39;$recipient&#39;&quot;: 0.0009 }&#39;&#39;&#39;)</code></pre>
<p>Though you placed a recipient and an amount in the output, it’s
irrelevent, because you’ll be rewriting those. A fancier bit of code
could read the existing <code>vout</code> info before rewriting, but
we’re keeping things very close to our <a
href="src/17_5_replacewithscript.c">original code</a>.</p>
<p>Here’s the one change necessary, to allow you to specify the satoshi
<code>vout</code>, without having to hardcode it, as in the
original:</p>
<pre><code>...
  int satoshis = atoi(argv[3]);
...
  lw_response = wally_tx_output_init_alloc(satoshis,p2sh,sizeof(p2sh),&amp;tx_output);
...</code></pre>
<p>Then you just run things like before:</p>
<pre><code>$ newtxhex=$(./replacewithscript $rawtxhex $script 9000)</code></pre>
<p>Here’s what the original transaction looked like:</p>
<pre><code>$ bitcoin-cli decoderawtransaction $rawtxhex
{
  &quot;txid&quot;: &quot;438d50edd7abeaf656c5abe856a00a20af5ff08939df8fdb9f8bfbfb96234fcb&quot;,
  &quot;hash&quot;: &quot;438d50edd7abeaf656c5abe856a00a20af5ff08939df8fdb9f8bfbfb96234fcb&quot;,
  &quot;version&quot;: 2,
  &quot;size&quot;: 82,
  &quot;vsize&quot;: 82,
  &quot;weight&quot;: 328,
  &quot;locktime&quot;: 0,
  &quot;vin&quot;: [
    {
      &quot;txid&quot;: &quot;c0a110a7a84399b98052c6545018873b13ee3128fa74f7a697779174a36ea33a&quot;,
      &quot;vout&quot;: 1,
      &quot;scriptSig&quot;: {
        &quot;asm&quot;: &quot;&quot;,
        &quot;hex&quot;: &quot;&quot;
      },
      &quot;sequence&quot;: 4294967295
    }
  ],
  &quot;vout&quot;: [
    {
      &quot;value&quot;: 0.00090000,
      &quot;n&quot;: 0,
      &quot;scriptPubKey&quot;: {
        &quot;asm&quot;: &quot;0 2621b0465d851d6ba4e61a667b7ab13e3740e0f7&quot;,
        &quot;hex&quot;: &quot;00142621b0465d851d6ba4e61a667b7ab13e3740e0f7&quot;,
        &quot;reqSigs&quot;: 1,
        &quot;type&quot;: &quot;witness_v0_keyhash&quot;,
        &quot;addresses&quot;: [
          &quot;tb1qycsmq3jas5wkhf8xrfn8k7438cm5pc8h9ae2k0&quot;
        ]
      }
    }
  ]
}</code></pre>
<p>And here’s the transaction rewritten by Libwally to use a P2SH:</p>
<pre><code>standup@btctest:~/c$ bitcoin-cli decoderawtransaction $newtxhex
{
  &quot;txid&quot;: &quot;badb57622ab5fe029fc1a71ace9f7b76c695f933bceb0d38a155c2e5c984f4e9&quot;,
  &quot;hash&quot;: &quot;badb57622ab5fe029fc1a71ace9f7b76c695f933bceb0d38a155c2e5c984f4e9&quot;,
  &quot;version&quot;: 2,
  &quot;size&quot;: 83,
  &quot;vsize&quot;: 83,
  &quot;weight&quot;: 332,
  &quot;locktime&quot;: 0,
  &quot;vin&quot;: [
    {
      &quot;txid&quot;: &quot;c0a110a7a84399b98052c6545018873b13ee3128fa74f7a697779174a36ea33a&quot;,
      &quot;vout&quot;: 1,
      &quot;scriptSig&quot;: {
        &quot;asm&quot;: &quot;&quot;,
        &quot;hex&quot;: &quot;&quot;
      },
      &quot;sequence&quot;: 0
    }
  ],
  &quot;vout&quot;: [
    {
      &quot;value&quot;: 0.00090000,
      &quot;n&quot;: 0,
      &quot;scriptPubKey&quot;: {
        &quot;asm&quot;: &quot;OP_HASH160 3f58b4f7b14847a9083694b9b3b52a4cea2569ed OP_EQUAL&quot;,
        &quot;hex&quot;: &quot;a9143f58b4f7b14847a9083694b9b3b52a4cea2569ed87&quot;,
        &quot;reqSigs&quot;: 1,
        &quot;type&quot;: &quot;scripthash&quot;,
        &quot;addresses&quot;: [
          &quot;2My2ApqGcoNXYceZC4d7fipBu4GodkbefHD&quot;
        ]
      }
    }
  ]
}</code></pre>
<p>Afterward you can sign it as usual with <code>bitcoin-cli</code>:</p>
<pre><code>$ signedtx=$(bitcoin-cli signrawtransactionwithwallet $newtxhex | jq -r &#39;.hex&#39;)</code></pre>
<p>And as you can see, the result is a legitimate transaction ready to
go out to the Bitcoin network:</p>
<pre><code>$ bitcoin-cli decoderawtransaction $signedtx
{
  &quot;txid&quot;: &quot;3061ca8c01d029c0086adbf8b7d4280280c8aee151500bab7c4f783bbc8e75e6&quot;,
  &quot;hash&quot;: &quot;3061ca8c01d029c0086adbf8b7d4280280c8aee151500bab7c4f783bbc8e75e6&quot;,
  &quot;version&quot;: 2,
  &quot;size&quot;: 189,
  &quot;vsize&quot;: 189,
  &quot;weight&quot;: 756,
  &quot;locktime&quot;: 0,
  &quot;vin&quot;: [
    {
      &quot;txid&quot;: &quot;c0a110a7a84399b98052c6545018873b13ee3128fa74f7a697779174a36ea33a&quot;,
      &quot;vout&quot;: 1,
      &quot;scriptSig&quot;: {
        &quot;asm&quot;: &quot;3044022026c81b6ff4a15135d10c7f4b1ae6e44ac4fdb25c4a3c03161b17b8ab8d04850502200b448d070f418de1ca07e76943d23d447bc95c7c5e0322bcc153cadb5d9befe0[ALL] 0368d0fffa651783524f8b934d24d03b32bf8ff2c0808943a556b3d74b2e5c7d65&quot;,
        &quot;hex&quot;: &quot;473044022026c81b6ff4a15135d10c7f4b1ae6e44ac4fdb25c4a3c03161b17b8ab8d04850502200b448d070f418de1ca07e76943d23d447bc95c7c5e0322bcc153cadb5d9befe001210368d0fffa651783524f8b934d24d03b32bf8ff2c0808943a556b3d74b2e5c7d65&quot;
      },
      &quot;sequence&quot;: 0
    }
  ],
  &quot;vout&quot;: [
    {
      &quot;value&quot;: 0.00090000,
      &quot;n&quot;: 0,
      &quot;scriptPubKey&quot;: {
        &quot;asm&quot;: &quot;OP_HASH160 3f58b4f7b14847a9083694b9b3b52a4cea2569ed OP_EQUAL&quot;,
        &quot;hex&quot;: &quot;a9143f58b4f7b14847a9083694b9b3b52a4cea2569ed87&quot;,
        &quot;reqSigs&quot;: 1,
        &quot;type&quot;: &quot;scripthash&quot;,
        &quot;addresses&quot;: [
          &quot;2My2ApqGcoNXYceZC4d7fipBu4GodkbefHD&quot;
        ]
      }
    }
  ]
}</code></pre>
<p>Voila! That’s the power of Libwally with
<code>bitcoin-cli</code>.</p>
<p>Obviously, you can also pass around a PSBT using the functions
described in <a href="17_4_Using_PSBTs_in_Libwally.md">§17.4</a> and
that’s a more up-to-date methodology for the modern-day usage of
Bitcoin, but in either example, the concept of passing transactions from
<code>bitcoin-cli</code> to Libwally code and back should be
similar.</p>
<h2 id="import-export-bip39-seeds">Import &amp; Export BIP39 Seeds</h2>
<p>Unfortunately, not all interactions between Libwally and
<code>bitcoin-cli</code> go as smoothly. For example, it would be nice
if you could either export an HD seed from <code>bitcoin-cli</code>, to
generate the mnemonic phrase with Libwally, or generate a seed from a
mneomnic phrase using Libwally, and then import it into
<code>bitcoin-cli</code>. Unfortunately, neither of these is possible at
this time. A mneomnic phrase is translated into a seed using
HMAC-SHA512, which means the result is 512 bits. However,
<code>bitcoin-cli</code> exports HD seeds (using
<code>dumpwallet</code>) and imports HD seeds (using
<code>sethdseed</code>) with a length of 256 bits. Until that is
changed, never the twain shall meet.</p>
<blockquote>
<p>:book: <strong><em>What’s the Difference Between Entropy &amp; a
Seed?</em></strong> Libwally says that it creates its mnemonic phrases
from entropy. That’s essentially the same thing as a seed: they’re both
large, randomized numbers. So, if <code>bitcoin-cli</code> was
compatible with 512-bit mnemonic-phrase seeds, you could use one to
generate the mneomnic phrases, and get the results that you’d
expect.</p>
</blockquote>
<blockquote>
<p>:book: <strong><em>What’s the difference between Entropy &amp; Raw
Entropy?</em></strong> Not all entropy is the same. When you input
entropy into a command that creates a mnemonic seed, it has to a
specific, well-understood length. Changing raw entropy into entropy
requires massaging the raw entropy until it’s the right length and
format, and at that point you could reuse that (non-raw) entropy to
always recreate the same mnemonics (which is why entropy is effectively
the same thing as a seed at that point, but raw entropy isn’t).</p>
</blockquote>
<h2 id="import-private-keys">Import Private Keys</h2>
<p>Fortunately, you can do much the same thing by importing a private
key generated in Libwally. Take a look at <a
href="src/17_7_genhd_for_import.c">genhd-for-import.c</a>, a simplified
version of the <code>genhd</code> program from <a
href="17_3_Using_BIP32_in_Libwally.md">§17.3</a> that also uses the
<code>jansson</code> library from <a
href="15_1_Accessing_Bitcoind_with_C.md">§16.1</a> for regularized
output.</p>
<p>The updated code also contains one change of note: it requests a
fingerprint from Libwally so that it can properly create a derivation
path:</p>
<pre><code>  char account_fingerprint[BIP32_KEY_FINGERPRINT_LEN];
  lw_response = bip32_key_get_fingerprint(key_account,account_fingerprint,BIP32_KEY_FINGERPRINT_LEN);

  char *fp_hex;
  lw_response = wally_hex_from_bytes(account_fingerprint,BIP32_KEY_FINGERPRINT_LEN,&amp;fp_hex);</code></pre>
<blockquote>
<p>:warning: <strong>WARNING:</strong> Remember that the fingerprint in
derivation paths is arbitrary. Because Libwally provides one, we’re
using it, but if you didn’t have one, you could add an arbitrary 4-byte
hexcode as a fingerprint to your derivation path.</p>
</blockquote>
<p>Be sure to compile the new code with the <code>jansson</code>
library, after installing it (if necessary) per <a
href="15_1_Accessing_Bitcoind_with_C.md">§16.1</a>.</p>
<pre><code>$ cc genhd-for-import.c -lwallycore -lsodium -ljansson -o genhd-for-import</code></pre>
<p>When you run the new program, it’ll give you a nicely output list of
everything:</p>
<pre><code>$ ./genhd-for-import 
{
  &quot;mnemonic&quot;: &quot;physical renew say quit enjoy eager topic remind riot concert refuse chair&quot;,
  &quot;account-xprv&quot;: &quot;tprv8yxn8iFNgsLktEPkWKQpMqb7bcx5ViFQEbJMtqrGi8LEgvy8es6YeJvyJKrbYEPKMw8JbU3RFhNRQ4F2pataAtTNokS1JXBZVg62xfd5HCn&quot;,
  &quot;address&quot;: &quot;tb1q9lhru6k0ymwrtr5w98w35n3lz22upml23h753n&quot;,
  &quot;derivation&quot;: &quot;[d1280779/84h/1h/0h]&quot;
}</code></pre>
<p>You have the <code>mnemonic</code> that you can recover from, an
<code>account-xprv</code> that you can import, a <code>derivation</code>
to use for the import, and a sample <code>address</code>, that you can
use for testing the import.</p>
<p>You can now fall back on lessons learned from <a
href="03_5_Understanding_the_Descriptor.md">§3.5</a> on how to turn that
xprv into a descriptor and import it.</p>
<p>First, you need to figure out the checksum:</p>
<pre><code>$ xprv=tprv8yxn8iFNgsLktEPkWKQpMqb7bcx5ViFQEbJMtqrGi8LEgvy8es6YeJvyJKrbYEPKMw8JbU3RFhNRQ4F2pataAtTNokS1JXBZVg62xfd5HCn
$ dp=[d1280779/84h/1h/0h]
$ bitcoin-cli getdescriptorinfo &quot;wpkh($dp$xprv/0/*)&quot;
{
  &quot;descriptor&quot;: &quot;wpkh([d1280779/84&#39;/1&#39;/0&#39;]tpubDWepH8HcqF2RmhRYPy5QmFFEAeU1f3SJotu9BMta8Q8dXRDuHFv8poYqUUtEiWftBjtKn1aNhi9Qg2P4NdzF66dShYvB92z78WJbYeHTLTz/0/*)#f8rmqc0z&quot;,
  &quot;checksum&quot;: &quot;46c00dk5&quot;,
  &quot;isrange&quot;: true,
  &quot;issolvable&quot;: true,
  &quot;hasprivatekeys&quot;: true
}</code></pre>
<p>There are three things to note here:</p>
<ol type="1">
<li>We use <code>wpkh</code> as the function in our derivation path.
That’s because we want to generate modern Segwit addresses, not legacy
addresses. That matches our usage in Libwally of the
<code>wally_bip32_key_to_addr_segwit</code> function. The most important
thing, however, is to have the same expectations with Libwally and
<code>bitcoin-cli</code> (and your descriptor) of what sort of address
you’re generating, so that everything matches!</li>
<li>We use the path <code>/0/*</code> because we wanted the external
addresses for this account. If we instead wanted the change addresses,
we’d use <code>/1/*</code>.</li>
<li>We are not going to use the returned <code>descriptor</code> line,
as it’s for a <code>xpub</code> address. Instead we’ll apply the
returned <code>checksum</code> to the <code>xprv</code> that we already
have.</li>
</ol>
<pre><code>$ cs=$(bitcoin-cli getdescriptorinfo &quot;wpkh($dp$xprv/0/*)&quot; | jq -r &#39; .checksum&#39;)</code></pre>
<p>You then plug that into <code>importmulti</code> to import this key
into <code>bitcoin-cli</code>:</p>
<pre><code>$ bitcoin-cli importmulti &#39;&#39;&#39;[{ &quot;desc&quot;: &quot;wpkh(&#39;$dp&#39;&#39;$xprv&#39;/0/*)#&#39;$cs&#39;&quot;, &quot;timestamp&quot;: &quot;now&quot;, &quot;range&quot;: 10, &quot;watchonly&quot;: false, &quot;label&quot;: &quot;LibwallyImports&quot;, &quot;keypool&quot;: false, &quot;rescan&quot;: false }]&#39;&#39;&#39;
[
  {
    &quot;success&quot;: true
  }
]
</code></pre>
<p>Here, you imported/generated the first ten addresses for the private
key.</p>
<p>Examining the new <code>LibwallyImported</code> label shows them:</p>
<pre><code>$ bitcoin-cli getaddressesbylabel &quot;LibwallyImports&quot;
{
  &quot;tb1qzeqrrt77xhvazq5g8sc9th0lzjwstknan8gzq7&quot;: {
    &quot;purpose&quot;: &quot;receive&quot;
  },
  &quot;tb1q9lhru6k0ymwrtr5w98w35n3lz22upml23h753n&quot;: {
    &quot;purpose&quot;: &quot;receive&quot;
  },
  &quot;tb1q8fsgxt0z9r9hfl5mst5ylxka2yljjxlxlvaf8j&quot;: {
    &quot;purpose&quot;: &quot;receive&quot;
  },
  &quot;tb1qg6dayhdk4qc6guutxvdweh6pctc9dpguu6awqc&quot;: {
    &quot;purpose&quot;: &quot;receive&quot;
  },
  &quot;tb1qdphaj0exvemxhgfpyh4p99wn84e2533u7p96l6&quot;: {
    &quot;purpose&quot;: &quot;receive&quot;
  },
  &quot;tb1qwv9mdqkpx6trtmvgw3l95npq8gk9pgllucvata&quot;: {
    &quot;purpose&quot;: &quot;receive&quot;
  },
  &quot;tb1qwh92pkrv6sps62udnmez65vfxe9n5ceuya56xz&quot;: {
    &quot;purpose&quot;: &quot;receive&quot;
  },
  &quot;tb1q4e98ln8xlym64qjzy3k8zyfyt5q60dgcn39d90&quot;: {
    &quot;purpose&quot;: &quot;receive&quot;
  },
  &quot;tb1qhzje887fyl65j4mulqv9ysmntwn95zpgmgvtqd&quot;: {
    &quot;purpose&quot;: &quot;receive&quot;
  },
  &quot;tb1q62xf9ec8zcfkh2qy5qnq4qcxrx8l0jm27dd8ru&quot;: {
    &quot;purpose&quot;: &quot;receive&quot;
  },
  &quot;tb1qlw85usfk446ssxejm9dmxsfn40kzsqce77aq20&quot;: {
    &quot;purpose&quot;: &quot;receive&quot;
  }
}
</code></pre>
<p>The second one on your list indeed matches your sample
(<code>tb1q9lhru6k0ymwrtr5w98w35n3lz22upml23h753n</code>). The import of
this private key and the derivation of ten addresses was successful.</p>
<p>If you now look back at <a
href="07_3_Integrating_with_Hardware_Wallets.md">§7.3</a>, you’ll see
this was the same methodology we used to import addresses from a
Hardware Wallet (though this time we also imported the private key as
proof of concept). The biggest difference is that previously the
information was created by a black box (literally: it was a Ledger
device), and this time you created the information yourself using
Libwally, showing how you can do this sort of work on airgapped or other
more remote devices, then bring it over to <code>bitcoin-cli</code>.</p>
<h2 id="import-addresses">Import Addresses</h2>
<p>Obviously, if you can import private keys, you can import addresses
too — which usually means importing watch-only addresses
<em>without</em> the private keys.</p>
<p>One way to do so is to use the <code>importmulti</code> methodology
above, but to use the supplied xpub address
(<code>wpkh([d1280779/84'/1'/0']tpubDWepH8HcqF2RmhRYPy5QmFFEAeU1f3SJotu9BMta8Q8dXRDuHFv8poYqUUtEiWftBjtKn1aNhi9Qg2P4NdzF66dShYvB92z78WJbYeHTLTz/0/*)#f8rmqc0z</code>)
rather than original xprv. That’s the best way to import a whole
sequence of watch-only addresses.</p>
<p>Alternatively, you can import individual addresses. For example,
consider the single sample address currently returned by the
<code>genhd-for-import</code> program:</p>
<pre><code>$ ./genhd-for-import 
{
  &quot;mnemonic&quot;: &quot;finish lady crucial walk illegal ride hamster strategy desert file twin nature&quot;,
  &quot;account-xprv&quot;: &quot;tprv8xRujYeVN7CwBHxLoTHRdmzwdW7dKUzDfruSo56GqqfRW9QXtnxnaRG8ke7j65uNjxmCVfcagz5uuaMi2vVJ8jpiGZvLwahmNB8F3SHUSyv&quot;,
  &quot;address&quot;: &quot;tb1qtvcchgyklp6cyleth85c7pfr4j72z2vyuwuj3d&quot;,
  &quot;derivation&quot;: &quot;[6214ecff/84h/1h/0h]&quot;
}</code></pre>
<p>You can import that as a watch-only address with
<code>importaddress</code>:</p>
<pre><code>$ bitcoin-cli -named importaddress address=tb1qtvcchgyklp6cyleth85c7pfr4j72z2vyuwuj3d label=LibwallyWO rescan=false
$ bitcoin-cli getaddressesbylabel &quot;LibwallyWO&quot;
{
  &quot;tb1qtvcchgyklp6cyleth85c7pfr4j72z2vyuwuj3d&quot;: {
    &quot;purpose&quot;: &quot;receive&quot;
  }
}
}</code></pre>
<h2 id="summary-integrating-libwally-and-bitcoin-cli">Summary:
Integrating Libwally and Bitcoin-CLI</h2>
<p>With a foundational knowledge of Libwally, you can now complement all
of the work of your previous lessons. Transferring addresses, keys,
transactions, and PSBTs are just some of the ways in which you might
make use these two powerful Bitcoin programming methods together.
There’s also much more potential depth if you want to dig deeper into
Libwally’s extensive library of functions.</p>
<blockquote>
<p>:fire: <strong><em>What is the Power of Integrating Libwally and
Bitcoin-CLI?</em></strong> One of the biggest advantages of Libwally is
that it has lots of functions that can be used offline. In comparison,
Bitcoin Core is a networked program. This can help you increase security
by having <code>bitcoin-cli</code> pass off keys, addresses,
transactions, or PSBTs to an offline source (which would be running
Libwally programs). Besides that, Libwally can do things that Bitcoin
Core currently can’t, such as generating a seed from a BIP39 mnemonic
(and even if you can’t currently import the seed to Bitcoin Core, you
<em>can</em> still import the master key for the account, as shown
here).</p>
</blockquote>
<h2 id="whats-next">What’s Next?</h2>
<p>Learn about other sorts of programming in <a
href="18_0_Talking_to_Bitcoind_Other.md">Chapter 18: Talking to Bitcoind
with Other Languages</a>.</p>
</body>
</html>
