<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>03_5_Understanding_the_Descriptor</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<h1 id="understanding-the-descriptor">3.5: Understanding the
Descriptor</h1>
<blockquote>
<p>:information_source: <strong>NOTE:</strong> This section has been
recently added to the course and is an early draft that may still be
awaiting review. Caveat reader.</p>
</blockquote>
<p>You may have noticed a weird <code>desc:</code> field in the
<code>listunspent</code> command of the previous section. Here’s what’s
all about (and how it can be used to transfer addresses).</p>
<blockquote>
<p>:warning: <strong>VERSION WARNING:</strong> This is an innovation
from Bitcoin Core v 0.17.0 that had continued to be expanded through
Bitcoin Core 0.20.0. Most of the commands in this section are from
0.17.0, but the updated <code>importmulti</code> that support
descriptors is from 0.18.0.</p>
</blockquote>
<h2 id="know-about-transferring-addresses">Know about Transferring
Addresses</h2>
<p>Most of this course presumes that you’re working entirely from a
single node where you manage your own wallet, sending and receiving
payments with the addresses created by that wallet. However, that’s not
necessarily how the larger Bitcoin ecosystem works. There, you’re more
likely to be moving addresses between wallets and even setting up
wallets to watch over funds controlled by different wallets.</p>
<p>That’s where descriptors come in. They’re most useful if you’re
interacting with software <em>other</em> than Bitcoin Core, and really
need to lean on this sort of compatibility function: see <a
href="https://github.com/BlockchainCommons/Learning-Bitcoin-from-the-Command-Line/blob/master/06_1_Sending_a_Transaction_to_a_Multisig.md">§6.1</a>
for a real-world example of how having the capability of descriptors is
critical.</p>
<p>Moving addresses between wallets used to focus on <code>xpub</code>
and <code>xprv</code>, and those are still supported.</p>
<blockquote>
<p>:book: <strong><em>What is xprv?</em></strong> An extended private
key. This is the combination of a private key and a chain code. It’s a
private key that a whole sequence of children private keys can be
derived from.</p>
</blockquote>
<blockquote>
<p>:book: <strong><em>What is xpub?</em></strong> An extended public
key. This is the combination of a public key and a chain code. It’s a
public key that a whole sequence of children public keys can be derived
from.</p>
</blockquote>
<p>The fact that you can have a “whole sequence of children … keys”
reveals the fact that “xpub” and “xprv” aren’t standard keys like we’ve
been talking about so far. They’re instead hierarchical keys that can be
used to create whole families of keys, built on the idea of HD
Wallets.</p>
<blockquote>
<p>:book: <strong><em>What is an HD Wallet?</em></strong> Most modern
wallets are built on <a
href="https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki">BIP32:
Hierarchical Deterministic Wallets</a>. This is a hierarchical design
where a single seed can be used to generate a whole sequence of keys.
The entire wallet may then be restored from that seed, rather than
requiring the restoring of every single private key.</p>
</blockquote>
<blockquote>
<p>:book: <strong><em>What is a Derivation Path?</em></strong> When you
have hierarchical keys, you need to be able to define individual keys as
descendents of a seed. For example <code>[0]</code> is the 0th key,
<code>[0/1]</code> is the first son of the 0th key, <code>[1/0/1]</code>
is the first grandson of the zeroth son of the 1st key. Some keys also
contain a <code>'</code> after the number, to show they’re hardened,
which protects them from a specific attack that can be used to derive an
<code>xprv</code> from an <code>xpub</code>. You don’t need to worry
about the specifics, other than the fact that those <code>'</code>s will
cause you formatting troubles when working from the command line.</p>
</blockquote>
<blockquote>
<p>:information_source: <strong>NOTE:</strong> a derivation path defines
a key, which means that a key represents a derivation path. They’re
equivalent. In the case of a descriptor, the derivation path lets
<code>bitcoind</code> know where the key that follows in the descriptor
came from!</p>
</blockquote>
<p><code>xpubs</code> and <code>xprvs</code> proved insufficient when
the types of public keys multiplied under the <a
href="https://github.com/BlockchainCommons/Learning-Bitcoin-from-the-Command-Line/blob/master/04_6_Creating_a_Segwit_Transaction.md">SegWit
expansion</a>, thus the need for “output descriptors”.</p>
<blockquote>
<p>:book: <strong><em>What is an output descriptor?</em></strong> A
precise description of how to derive a Bitcoin address from a
combination of a function and one or more inputs to that function.</p>
</blockquote>
<p>The introduction of functions into descriptors is what makes them
powerful, because they can be used to transfer all sorts of addresses,
from the Legacy addresses that we’re working with now to the Segwit and
multisig addresses that we’ll meet down the road. An individual function
matches a particular type of address and correlates with specific rules
to generate that address.</p>
<h2 id="capture-a-descriptor">Capture a Descriptor</h2>
<p>Descriptors are visible in several commands such as
<code>listunspent</code> and <code>getaddressinfo</code>:</p>
<pre><code>$ bitcoin-cli getaddressinfo ms7ruzvL4atCu77n47dStMb3of6iScS8kZ
{
  &quot;address&quot;: &quot;ms7ruzvL4atCu77n47dStMb3of6iScS8kZ&quot;,
  &quot;scriptPubKey&quot;: &quot;76a9147f437379bcc66c40745edc1891ea6b3830e1975d88ac&quot;,
  &quot;ismine&quot;: true,
  &quot;solvable&quot;: true,
  &quot;desc&quot;: &quot;pkh([d6043800/0&#39;/0&#39;/18&#39;]03efdee34c0009fd175f3b20b5e5a5517fd5d16746f2e635b44617adafeaebc388)#4ahsl9pk&quot;,
  &quot;iswatchonly&quot;: false,
  &quot;isscript&quot;: false,
  &quot;iswitness&quot;: false,
  &quot;pubkey&quot;: &quot;03efdee34c0009fd175f3b20b5e5a5517fd5d16746f2e635b44617adafeaebc388&quot;,
  &quot;iscompressed&quot;: true,
  &quot;ischange&quot;: false,
  &quot;timestamp&quot;: 1592335136,
  &quot;hdkeypath&quot;: &quot;m/0&#39;/0&#39;/18&#39;&quot;,
  &quot;hdseedid&quot;: &quot;fdea8e2630f00d29a9d6ff2af7bf5b358d061078&quot;,
  &quot;hdmasterfingerprint&quot;: &quot;d6043800&quot;,
  &quot;labels&quot;: [
    &quot;&quot;
  ]
}</code></pre>
<p>Here the descriptor is
<code>pkh([d6043800/0'/0'/18']03efdee34c0009fd175f3b20b5e5a5517fd5d16746f2e635b44617adafeaebc388)#4ahsl9pk</code>.</p>
<h2 id="understand-a-descriptor">Understand a Descriptor</h2>
<p>A descriptor is broken into several parts:</p>
<pre><code>function([derivation-path]key)#checksum</code></pre>
<p>Here’s what that all means: * <strong>Function.</strong> The function
that is used to create an address from that key. In this cases it’s
<code>pkh</code>, which is the standard P2PKH legacy address that you
met in <a href="03_3_Setting_Up_Your_Wallet.md">§3.3: Setting Up Your
Wallet</a>. Similarly, a P2WSH SegWit address would use <code>wsh</code>
and a P2WPKH address would use <code>wpkh</code>. * <strong>Derivation
Path.</strong> This describes what part of an HD wallet is being
exported. In this case it’s a seed with the fingerprint
<code>d6043800</code> and then the 18th child of the 0th child of the
0th child (<code>0'/0'/18'</code>) of that seed. There may also be a
further derivation after the key:
<code>function([derivation-path]key/more-derivation)#checksum</code> *
It’s worth noting here that if you ever get a derivation path without a
fingerprint, you can make it up. It’s just that if there’s an existing
one, you should match it, because if you ever go back to the device that
created the fingerprint, you’ll need to have the same one. *
<strong>Key</strong>. The key or keys that are being transferred. This
could be something traditional like an <code>xpub</code> or
<code>xprv</code>, it could just be a public key for an address as in
this case, it could be a set of addresses for a multi-signature, or it
could be something else. This is the core data: the function explains
what to do with it. * <strong>Checksum</strong>. Descriptors are meant
to be human transferrable. This checksum makes sure you got it
right.</p>
<p>See <a
href="https://github.com/bitcoin/bitcoin/blob/master/doc/descriptors.md">Bitcoin
Core’s Info on Descriptor Support</a> for more information.</p>
<h2 id="examine-a-descriptor">Examine a Descriptor</h2>
<p>You can look at a descriptor with the <code>getdescriptorinfo</code>
RPC:</p>
<pre><code>$ bitcoin-cli getdescriptorinfo &quot;pkh([d6043800/0&#39;/0&#39;/18&#39;]03efdee34c0009fd175f3b20b5e5a5517fd5d16746f2e635b44617adafeaebc388)#4ahsl9pk&quot;
{
  &quot;descriptor&quot;: &quot;pkh([d6043800/0&#39;/0&#39;/18&#39;]03efdee34c0009fd175f3b20b5e5a5517fd5d16746f2e635b44617adafeaebc388)#4ahsl9pk&quot;,
  &quot;checksum&quot;: &quot;4ahsl9pk&quot;,
  &quot;isrange&quot;: false,
  &quot;issolvable&quot;: true,
  &quot;hasprivatekeys&quot;: false
}</code></pre>
<p>Note that it returns a checksum. If you’re ever given a descriptor
without a checksum, you can learn it with this command:</p>
<pre><code>$ bitcoin-cli getdescriptorinfo &quot;pkh([d6043800/0&#39;/0&#39;/18&#39;]03efdee34c0009fd175f3b20b5e5a5517fd5d16746f2e635b44617adafeaebc388)&quot;
{
  &quot;descriptor&quot;: &quot;pkh([d6043800/0&#39;/0&#39;/18&#39;]03efdee34c0009fd175f3b20b5e5a5517fd5d16746f2e635b44617adafeaebc388)#4ahsl9pk&quot;,
  &quot;checksum&quot;: &quot;4ahsl9pk&quot;,
  &quot;isrange&quot;: false,
  &quot;issolvable&quot;: true,
  &quot;hasprivatekeys&quot;: false
}</code></pre>
<p>Besides giving you the checksum, this command also verifies the
validity of the descriptor and provides useful information like whether
a descriptor contains private keys.</p>
<p>One of the powers of a descriptor is being able to derive an address
in a regular way. This is done with the <code>deriveaddresses</code>
RPC.</p>
<pre><code>$ bitcoin-cli deriveaddresses &quot;pkh([d6043800/0&#39;/0&#39;/18&#39;]03efdee34c0009fd175f3b20b5e5a5517fd5d16746f2e635b44617adafeaebc388)#4ahsl9pk&quot;
[
  &quot;ms7ruzvL4atCu77n47dStMb3of6iScS8kZ&quot;
]</code></pre>
<p>You’ll note it loops back to the address we started with (as it
should).</p>
<h2 id="import-a-descriptor">Import a Descriptor</h2>
<p>But, the really important thing about a descriptor is that you can
take it to another (remote) machine and import it. This is done with the
<code>importmulti</code> RPC using the <code>desc</code> option:</p>
<pre><code>remote$ bitcoin-cli importmulti &#39;[{&quot;desc&quot;: &quot;pkh([d6043800/0&#39;&quot;&#39;&quot;&#39;/0&#39;&quot;&#39;&quot;&#39;/18&#39;&quot;&#39;&quot;&#39;]03efdee34c0009fd175f3b20b5e5a5517fd5d16746f2e635b44617adafeaebc388)#4ahsl9pk&quot;, &quot;timestamp&quot;: &quot;now&quot;, &quot;watchonly&quot;: true}]&#39;
[
  {
    &quot;success&quot;: true
  }
]</code></pre>
<p>First, you’ll note our first really ugly use of quotes. Every
<code>'</code> in the derivation path had to be replaced with
<code>'"'"'</code>. Just expect to have to do that if you’re
manipulating a descriptor that contains a derivation path. (The other
option is to exchange the <code>'</code> with a <code>h</code> for
hardened, but that will change you checksum, so if you prefer that for
its ease of use, you’ll need to get a new checksum with
<code>getdescriptorinfo</code>.)</p>
<p>Second, you’ll note that we flagged this as <code>watchonly</code>.
That’s because we know that it’s a public key, so we can’t spend with
it. If we’d failed to enter this flag, <code>importmulti</code> would
helpfully have told us something like:
<code>Some private keys are missing, outputs will be considered watchonly. If this is intentional, specify the watchonly flag.</code>.</p>
<blockquote>
<p>:book: <strong><em>What is a watch-only address?</em></strong> A
watch-only address allows you to watch for transactions related to an
address (or to a whole family of addresses if you used an
<code>xpub</code>), but not to spend funds on those addresses.</p>
</blockquote>
<p>Using <code>getaddressesbylabel</code>, we can now see that our
address has correctly been imported into our remote machine!</p>
<pre><code>remote$ bitcoin-cli getaddressesbylabel &quot;&quot;
{
  &quot;ms7ruzvL4atCu77n47dStMb3of6iScS8kZ&quot;: {
    &quot;purpose&quot;: &quot;receive&quot;
  }
}</code></pre>
<h2 id="summary-understanding-the-descriptor">Summary: Understanding the
Descriptor</h2>
<p>Descriptors let you pass public keys and private keys among wallets,
but more than that, they allow you to precisely and correctly to define
addresses and to derive addresses of a lot of different sorts from a
standardized description format.</p>
<blockquote>
<p>:fire: <strong><em>What is the power of descriptors?</em></strong>
Descriptors allow you to import and export seeds and keys. That’s great
if you want to move between different wallets. As a developer, they also
allow you to build up the precise sort of addresses that you’re
interested in creating. For example, we use it in <a
href="https://github.com/BlockchainCommons/FullyNoded-2/blob/master/Docs/How-it-works.md">FullyNoded
2</a> to generate a multi-sig from three seeds.</p>
</blockquote>
<p>We’ll make real use of descriptors in <a
href="07_3_Integrating_with_Hardware_Wallets.md">§7.3</a>, when we’re
importing addresses from a hardware wallet.</p>
<h2 id="whats-next">What’s Next?</h2>
<p>Advance through “bitcoin-cli” with <a
href="04_0_Sending_Bitcoin_Transactions.md">Chapter Four: Sending
Bitcoin Transactions</a>.</p>
</body>
</html>
