<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>03_3_Setting_Up_Your_Wallet</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<h1 id="setting-up-your-wallet">3.3: Setting Up Your Wallet</h1>
<p>You’re now ready to start working with Bitcoin. To begin with, you’ll
need to create a wallet for sending and receiving funds.</p>
<h2 id="create-a-wallet">Create a Wallet</h2>
<blockquote>
<p>:warning: <strong>VERSION WARNING:</strong> Newer versions of Bitcoin
Core, starting with v0.21.0, will no longer automatically create a
default wallet on startup. So, you will need to manually create one. But
if you’re running an older version of Bitcoin Core, a new wallet has
already been created for you, in which case you can skip ahead to <a
href="#create-an-address">Create an Address</a>.</p>
</blockquote>
<p>The first thing you need to do is create a new wallet, which can be
done with the <code>bitcoin-cli createwallet</code> command. By creating
a new wallet, you’ll be creating your public-private key pair. Your
public key is the source from which your addresses will be created, and
your private key is what will allow you to spend any funds you receive
into your addresses. Bitcoin Core will automatically save that
information into a <code>wallet.dat</code> file in your
<code>~/.bitcoin/testnet3/wallets</code> directory.</p>
<p>If you check your <code>wallets</code> directory, you’ll see that
it’s currently empty.</p>
<pre><code>$ ls ~/.bitcoin/testnet3/wallets
$</code></pre>
<p>Although Bitcoin Core won’t create a new wallet for you, it will
still load a top-level unnamed (““) wallet on startup by default. You
can take advantage of this by creating a new unnamed wallet.</p>
<pre><code>$ bitcoin-cli createwallet &quot;&quot;
{
  &quot;name&quot;: &quot;&quot;,
  &quot;warning&quot;: &quot;&quot;
}</code></pre>
<p>Now, your <code>wallets</code> directory should be populated.</p>
<pre><code>$ ls ~/.bitcoin/testnet3/wallets
database  db.log  wallet.dat</code></pre>
<blockquote>
<p>:book: <strong><em>What is a Bitcoin wallet?</em></strong> A Bitcoin
wallet is the digital equivalent of a physical wallet on the Bitcoin
network. It stores information on the amount of bitcoins you have and
where it’s located (addresses), as well as the ways you can use to spend
it. Spending physical money is intuitive, but to spend bitcoins users
need to provide the correct <em>private key</em>. We will explain this
in more detail throughout the course, but what you should know for now
is that this public-private key dynamic is part of what makes Bitcoin
secure and trustless. Your key pair information is saved in the
<code>wallet.dat</code> file, in addition to data about preferences and
transactions. For the most part, you won’t have to worry about that
private key: <code>bitcoind</code> will use it when it’s needed.
However, this makes the <code>wallet.dat</code> file extremely
important: if you lose it, you lose your private keys, and if you lose
your private keys, you lose your funds!</p>
</blockquote>
<p>Sweet, now you have a Bitcoin wallet. But a wallet will be of little
use for receiving bitcoins if you don’t create an address first.</p>
<h2 id="create-an-address">Create an Address</h2>
<p>The next thing you need to do is create an address for receiving
payments. This is done with the <code>bitcoin-cli getnewaddress</code>
command. Remember that if you want more information on this command, you
should type <code>bitcoin-cli help getnewaddress</code>. Currently,
there are three types of addresses: <code>legacy</code> and the two
types of SegWit address, <code>p2sh-segwit</code> and
<code>bech32</code>. If you do not otherwise specify, you’ll get the
default, which is currently <code>bech32</code>.</p>
<p>However, for the next few sections we’re instead going to be using
<code>legacy</code> addresses, both because <code>bitcoin-cli</code> had
some teething problems with its early versions of SegWit addresses, and
because other people might not be able to send to <code>bech32</code>
addresses. This is all unlikely to be a problem for you now, but for the
moment we want to get your started with transaction examples that are
(mostly) guaranteed to work.</p>
<p>First, restart <code>bitcoind</code> so your new unnamed wallet is
set as default and automatically loaded.</p>
<pre><code>$ bitcoin-cli stop
Bitcoin Core stopping # wait a minute so it stops completely
$ bitcoind -daemon
Bitcoin Core starting # wait a minute so it starts completely</code></pre>
<p>You can now create an address. You can require <code>legacy</code>
address either with the second argument to <code>getnewaddress</code> or
with the named <code>addresstype</code> argument.</p>
<pre><code>$ bitcoin-cli getnewaddress -addresstype legacy
moKVV6XEhfrBCE3QCYq6ppT7AaMF8KsZ1B</code></pre>
<p>Note that this address begins with an “m” (or sometimes an “n”) to
signify a testnet Legacy address. It would be a “2” for a P2SH address
or a “tb1” for a Bech32 address.</p>
<blockquote>
<p>:link: <strong>TESTNET vs MAINNET:</strong> The equivalent mainnet
address would start with a “1” (for Legacy), “3” (for P2SH), or “bc1”
(for Bech32).</p>
</blockquote>
<p>Take careful note of the address. You’ll need to give it to whomever
will be sending you funds.</p>
<blockquote>
<p>:book: <strong><em>What is a Bitcoin address?</em></strong> A Bitcoin
address is literally where you receive money. It’s like an email
address, but for funds. Technically, it’s a public key, though different
address schemes adjust that in different ways. However unlike an email
address, a Bitcoin address should be considered single use: use it to
receive funds just <em>once</em>. When you want to receive funds from
someone else or at some other time, generate a new address. This is
suggested in large part to improve your privacy. The whole blockchain is
immutable, which means that explorers can look at long chains of
transactions over time, making it possible to statistically determine
who you and your contacts are, no matter how careful you are. However,
if you keep reusing the same address, then this becomes even easier. By
creating your first Bitcoin address, you’ve also begun to fill in your
Bitcoin wallet. More precisely, you’ve begun to fill the
<code>wallet.dat</code> file in your
<code>~/.bitcoin/testnet3 /wallets</code> directory.</p>
</blockquote>
<p>With a single address in hand, you could jump straight to the next
section and begin receiving funds. However, before we get there, we’re
going to briefly discuss the other sorts of addresses that you’ll meet
in the future and talk about a few other wallet commands that you might
want to use in the future.</p>
<h3 id="knowing-your-bitcoin-addresses">Knowing Your Bitcoin
Addresses</h3>
<p>There are three types of Bitcoin addresses that you can create with
the <code>getnewaddress</code> RPC command. You’ll be using a
<code>legacy</code> (P2PKH) address here, while you’ll move over to a
SegWit (P2SH-SegWit) or Bech32 address in <a
href="04_6_Creating_a_Segwit_Transaction.md">§4.6: Creating a Segwit
Transaction</a>.</p>
<p>As noted above, the foundation of a Bitcoin address is a public key:
someone sends funds to your public key, and then you use your private
key to redeem it. Easy? Except putting your public key out there isn’t
entirely secure. At the moment, if someone has your public key, then
they can’t retrieve your private key (and thus your funds); that’s the
basis of cryptography, which uses a trap-door function to ensure that
you can only go from private to public key, and not vice-versa. But the
problem is that we don’t know what the future might bring. Except we do
know that cryptography systems eventually get broken by the relentless
advance of technology, so it’s better not to put raw public keys on the
’net, to future-proof your transactions.</p>
<p>Classic Bitcoin transactions created P2PKH addresses that added an
additional cryptographic step to protect public keys.</p>
<blockquote>
<p>:book: <strong><em>What is a Legacy (P2PKH) address?</em></strong>
This is a Legacy address of the sort used by the early Bitcoin network.
We’ll be using it in examples for the next few sections. It’s called a
Pay to PubKey Hash (or P2PKH) address because the address is a 160-bit
hash of a public key. Using a hash of your public key as your address
creates a two-step process where to spend funds you need to reveal both
the private key and the public key, and it increases future security
accordingly. This sort of address remains important for receiving funds
from people with out-of-date wallet software.</p>
</blockquote>
<p>As described more fully in <a
href="04_6_Creating_a_Segwit_Transaction.md">§4.6: Creating a Segwit
Transaction</a>, the Block Size Wars of the late ’10s resulted in a new
sort of address: SegWit. This is the preferred sort of address
currently, and should be fully integrated into Bitcoin-Core at this
point, but nonetheless we’re saving it for §4.6.</p>
<p>SegWit simply means “segregated witness” and it’s a way of separating
the transaction signatures out from the rest of the transaction to
reduce transaction size. Some SegWit addresses will sneak into some of
our examples prior to §4.6 as change addresses, which you’ll see as
addresses that begin with “tb”. This is fine because the
<code>bitcoin-cli</code> entirely supports their usage. But we won’t use
them otherwise.</p>
<p>There are two addresses of this sort:</p>
<blockquote>
<p>:book: <strong><em>What is a P2SH-SegWit (aka Nested SegWit)
address?</em></strong> This is the first generation of SegWit. It wraps
the SegWit address in a Script hash to ensure backward compatibility.
The result creates transactions that are about 25%+ smaller (with
corresponding reductions in transaction fees).</p>
</blockquote>
<blockquote>
<p>:book: <strong><em>What is a Bech32 (aka Native SegWit, aka P2WPKH)
address?</em></strong> This is the second generation of SegWit. It’s
fully described in <a href="https://en.bitcoin.it/wiki/BIP_0173">BIP
173</a>. It creates transactions that are even smaller but more notably
also has some advantages in creating addresses that are less prone to
human error and have some implicit error-correction beyond that. It is
<em>not</em> backward compatible like P2SH-SegWit was, and so some
people may not be able to send to it.</p>
</blockquote>
<p>There are other sorts of Bitcoin addresses, such as P2PK (which paid
to a bare public key, and is deprecated because of its future
insecurity) and P2SH (which pays to a Script Hash, and which is used by
the first-generation Nested SegWit addresses; we’ll meet it more fully
in a few chapters).</p>
<h2 id="optional-sign-a-message">Optional: Sign a Message</h2>
<p>Sometimes you’ll need to prove that you control a Bitcoin address (or
rather, that you control its private key). This is important because it
lets people know that they’re sending funds to the right person. This
can be done by creating a signature with the
<code>bitcoin-cli signmessage</code> command, in the form
<code>bitcoin-cli signmessage [address] [message]</code>. For
example:</p>
<pre><code>$ bitcoin-cli signmessage &quot;moKVV6XEhfrBCE3QCYq6ppT7AaMF8KsZ1B&quot; &quot;Hello, World&quot;
HyIP0nzdcH12aNbQ2s2rUxLwzG832HxiO1vt8S/jw+W4Ia29lw6hyyaqYOsliYdxne70C6SZ5Utma6QY/trHZBI=</code></pre>
<p>You’ll get the signature as a return.</p>
<blockquote>
<p>:book: <strong><em>What is a signature?</em></strong> A digital
signature is a combination of a message and a private key that can then
be unlocked with a public key. Since there’s a one-to-one correspendence
between the elements of a keypair, unlocking with a public key proves
that the signer controlled the corresponding private key.</p>
</blockquote>
<p>Another person can then use the
<code>bitcoin-cli verifymessage</code> command to verify the signature.
He inputs the address in question, the signature, and the message:</p>
<pre><code>$ bitcoin-cli verifymessage &quot;moKVV6XEhfrBCE3QCYq6ppT7AaMF8KsZ1B&quot; &quot;HyIP0nzdcH12aNbQ2s2rUxLwzG832HxiO1vt8S/jw+W4Ia29lw6hyyaqYOsliYdxne70C6SZ5Utma6QY/trHZBI=&quot; &quot;Hello, World&quot;
true</code></pre>
<p>If they all match up, then the other person knows that he can safely
transfer funds to the person who signed the message by sending to the
address.</p>
<p>If some black hat was making up signatures, this would instead
produce a negative result:</p>
<pre><code>$ bitcoin-cli verifymessage &quot;FAKEV6XEhfrBCE3QCYq6ppT7AaMF8KsZ1B&quot; &quot;HyIP0nzdcH12aNbQ2s2rUxLwzG832HxiO1vt8S/jw+W4Ia29lw6hyyaqYOsliYdxne70C6SZ5Utma6QY/trHZBI=&quot; &quot;Hello, World&quot;
error code: -3
error message:
Invalid address</code></pre>
<h2 id="optional-dump-your-wallet">Optional: Dump Your Wallet</h2>
<p>It might seem dangerous having all of your irreplaceable private keys
in a single file. That’s what <code>bitcoin-cli dumpwallet</code> is
for. It lets you make a copy of your wallet.dat:</p>
<pre><code>$ bitcoin-cli dumpwallet ~/mywallet.txt</code></pre>
<p>The <code>mywallet.txt</code> file in your home directory will have a
long list of private keys, addresses, and other information. Mind you,
you’d never want to put this data out in a plain text file on a Bitcoin
setup with real funds!</p>
<p>You can then recover it with
<code>bitcoin-cli importwallet</code>.</p>
<pre><code>$ bitcoin-cli importwallet ~/mywallet.txt</code></pre>
<p>But note this requires an unpruned node!</p>
<pre><code>$ bitcoin-cli importwallet ~/mywallet.txt
error code: -4
error message:
Importing wallets is disabled when blocks are pruned</code></pre>
<h2 id="optional-view-your-private-keys">Optional: View Your Private
Keys</h2>
<p>Sometimes, you might want to actually look at the private keys
associated with your Bitcoin addresses. Perhaps you want to be able to
sign a message or spend bitcoins from a different machine. Perhaps you
just want to back up certain important private keys. You can also do
this with your dump file, since it’s human readable.</p>
<pre><code>$ bitcoin-cli dumpwallet ~/mywallet.txt
{
  &quot;filename&quot;: &quot;/home/standup/mywallet.txt&quot;
}</code></pre>
<p>More likely, you just want to look at the private key associated with
a specific address. This can be done with the
<code>bitcoin-cli dumpprivkey</code> command.</p>
<pre><code>$ bitcoin-cli dumpprivkey &quot;moKVV6XEhfrBCE3QCYq6ppT7AaMF8KsZ1B&quot;
cTv75T4B3NsG92tdSxSfzhuaGrzrmc1rJjLKscoQZXqNRs5tpYhH</code></pre>
<p>You can then save that key somewhere safe, preferably somewhere not
connected to the internet.</p>
<p>You can also import any private key, from a wallet dump or an
individual key dump, as follows:</p>
<pre><code>$ bitcoin-cli importprivkey cW4s4MdW7BkUmqiKgYzSJdmvnzq8QDrf6gszPMC7eLmfcdoRHtHh</code></pre>
<p>Again, expect this to require an unpruned node. Expect this to take a
while, as <code>bitcoind</code> needs to reread all past transactions,
to see if there are any new ones that it should pay attention to.</p>
<blockquote>
<p>:information_source: <strong>NOTE:</strong> Many modern wallets
prefer <a
href="https://github.com/bitcoin/bips/blob/master/bip-0039.mediawiki">mnemonic
codes</a> to generate the seeds necessary to create the private keys.
This methodology is not used <code>bitcoin-cli</code>, so you won’t be
able to generate handy word lists to remember your private keys.</p>
</blockquote>
<p><em>You’ve been typing that Bitcoin address you generated a
<em>lot</em>, while you were signing messages and now dumping keys. If
you think it’s a pain, we agree. It’s also prone to errors, a topic that
we’ll address in the very next section.</em></p>
<h2 id="summary-setting-up-your-wallet">Summary: Setting Up Your
Wallet</h2>
<p>You need to create an address to receive funds. Your address is
stored in a wallet, which you can back up. You can also do lots more
with an address, like dumping its private key or using it to sign
messages. But really, creating that address is <em>all</em> you need to
do in order to receive Bitcoin funds.</p>
<h2 id="whats-next">What’s Next?</h2>
<p>Step back from “Understanding Your Bitcoin Setup” with <a
href="03_3__Interlude_Using_Command-Line_Variables.md">Interlude: Using
Command-Line Variables</a>.</p>
</body>
</html>
