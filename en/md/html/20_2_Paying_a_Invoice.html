<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>20_2_Paying_a_Invoice</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<h1 id="paying-an-invoice">20.2: Paying an Invoice</h1>
<blockquote>
<p>:information_source: <strong>NOTE:</strong> This section has been
recently added to the course and is an early draft that may still be
awaiting review. Caveat reader.</p>
</blockquote>
<p>In this chapter you will learn how to pay an invoice using
<code>lightning-cli pay</code> command. It assumes that you’ve already
looked over the invoice, per <a
href="20_1_Generate_a_Payment_Request.md">§20.1</a> and determined it
was valid.</p>
<h2 id="check-your-balance">Check your Balance</h2>
<p>Obviously, the first thing you need to do is make sure that you have
enough funds to pay an invoice. In this case, the channel set up
previously with
<code>032a7572dc013b6382cde391d79f292ced27305aa4162ec3906279fc4334602543</code>
contains 100,000 satoshis. This will be the channel used to pay the
invoice.</p>
<pre><code>c$ lightning-cli --testnet listfunds
{
   &quot;outputs&quot;: [
      {
         &quot;txid&quot;: &quot;66694d23ca15efe379e5f4a71d9be1a2d65e383b89ee3abe126ee36a12f23c1d&quot;,
         &quot;output&quot;: 1,
         &quot;value&quot;: 99847,
         &quot;amount_msat&quot;: &quot;99847000msat&quot;,
         &quot;scriptpubkey&quot;: &quot;00142fe02e5be9283e8c5bcb93ae61421baf8cb64f9c&quot;,
         &quot;address&quot;: &quot;tb1q9lszuklf9qlgck7tjwhxzssm47xtvnuu4jslf8&quot;,
         &quot;status&quot;: &quot;confirmed&quot;,
         &quot;blockheight&quot;: 1862856,
         &quot;reserved&quot;: false
      }
   ],
   &quot;channels&quot;: [
      {
         &quot;peer_id&quot;: &quot;032a7572dc013b6382cde391d79f292ced27305aa4162ec3906279fc4334602543&quot;,
         &quot;connected&quot;: true,
         &quot;state&quot;: &quot;CHANNELD_NORMAL&quot;,
         &quot;short_channel_id&quot;: &quot;1862856x29x0&quot;,
         &quot;channel_sat&quot;: 100000,
         &quot;our_amount_msat&quot;: &quot;100000000msat&quot;,
         &quot;channel_total_sat&quot;: 100000,
         &quot;amount_msat&quot;: &quot;100000000msat&quot;,
         &quot;funding_txid&quot;: &quot;66694d23ca15efe379e5f4a71d9be1a2d65e383b89ee3abe126ee36a12f23c1d&quot;,
         &quot;funding_output&quot;: 0
      }
   ]
}</code></pre>
<p>If you didn’t have enough funds, you’d need to create a new
channel.</p>
<h2 id="pay-your-invoice">Pay Your Invoice</h2>
<p>You use <code>lightning-cli pay</code> command to pay an invoice. It
will attempt to find a route to the given destination and send the funds
requested. Here that’s very simple because there’s a direct channel
between the payer and the recipient:</p>
<pre><code>c$ lightning-cli --testnet pay lntb100u1p0cwnqtpp5djkdahy4hz0wc909y39ap9tm3rq2kk9320hw2jtntwv4x39uz6asdr5ge5hyum5ypxyugzsv9uk6etwwssz6gzvv4shymnfdenjqsnfw33k76twypskuepqf35kw6r5de5kueeqveex7mfqw35x2gzrdakk6ctwvssxc6twv5hqcqzpgsp5a9ryqw7t23myn9psd36ra5alzvp6lzhxua58609teslwqmdljpxs9qy9qsq9ee7h500jazef6c306psr0ncru469zgyr2m2h32c6ser28vrvh5j4q23c073xsvmjwgv9wtk2q7j6pj09fn53v2vkrdkgsjv7njh9aqqtjn3vd
{
   &quot;destination&quot;: &quot;032a7572dc013b6382cde391d79f292ced27305aa4162ec3906279fc4334602543&quot;,
   &quot;payment_hash&quot;: &quot;6cacdedc95b89eec15e5244bd0957b88c0ab58b153eee549735b995344bc16bb&quot;,
   &quot;created_at&quot;: 1602704828.948,
   &quot;parts&quot;: 1,
   &quot;msatoshi&quot;: 10000000,
   &quot;amount_msat&quot;: &quot;10000000msat&quot;,
   &quot;msatoshi_sent&quot;: 10000000,
   &quot;amount_sent_msat&quot;: &quot;10000000msat&quot;,
   &quot;payment_preimage&quot;: &quot;1af4a9bb830e49b6bc8f0bef980630e189e3794ad1705f06ad1b9c71571dce0c&quot;,
   &quot;status&quot;: &quot;complete&quot;
}</code></pre>
<p>Note that here all the amounts are in <code>msats</code>, not
<code>sats</code>!</p>
<h3 id="pay-your-invoice-across-the-network">Pay Your Invoice Across the
Network</h3>
<p>However, you do <em>not</em> need to have a channel with a node in
order to pay them. There just needs to be a reasonable route across the
Lightning Network.</p>
<p>Imagine that you received this teeny payment request for 11,111
msat:</p>
<pre><code>c$ lightning-cli --testnet decodepay lntb111110p1p0cw43ppp5u0ngjytlw6ywec3x784jale4xd7h058g9u4mthcaf9rl2f7g8zxsdp2t9hh2gr0wajjqmt9ypnx7u3qv35kumn9wgs8gmm0yyxqyjw5qcqp2sp5kj4xhrthmfgcgyl84zaqpl9vvdjwm5x368kr09fu5nym74setw4s9qy9qsq8hxjr73ee77vat0ay603e4w9aa8ag9sa2n55xznk5lsfrjffxxdj2k0wznvcfa98l4a57s80j7dhg0cc03vwqdwehkujlzxgm0xyynqqslwhvl
{
   &quot;currency&quot;: &quot;tb&quot;,
   &quot;created_at&quot;: 1602704929,
   &quot;expiry&quot;: 604800,
   &quot;payee&quot;: &quot;02f3d74746934494fa378235e5bc44cfdbb5b8779d839263fb7f9218be032f6f61&quot;,
   &quot;msatoshi&quot;: 11111,
   &quot;amount_msat&quot;: &quot;11111msat&quot;,
   &quot;description&quot;: &quot;You owe me for dinner too!&quot;,
   &quot;min_final_cltv_expiry&quot;: 10,
   &quot;payment_secret&quot;: &quot;b4aa6b8d77da518413e7a8ba00fcac6364edd0d1d1ec37953ca4c9bf56195bab&quot;,
   &quot;features&quot;: &quot;028200&quot;,
   &quot;payment_hash&quot;: &quot;e3e689117f7688ece226f1eb2eff35337d77d0e82f2bb5df1d4947f527c8388d&quot;,
   &quot;signature&quot;: &quot;304402203dcd21fa39cfbcceadfd269f1cd5c5ef4fd4161d54e9430a76a7e091c929319b02202559ee14d984f4a7fd7b4f40ef979b743f187c58e035d9bdb92f88c8dbcc424c&quot;
}</code></pre>
<p>If you tried to pay it, and you didn’t have a route to the recipient
through the Lightning Network, you could expect an error like this:</p>
<pre><code>c$ lightning-cli --testnet pay lntb111110p1p0cw43ppp5u0ngjytlw6ywec3x784jale4xd7h058g9u4mthcaf9rl2f7g8zxsdp2t9hh2gr0wajjqmt9ypnx7u3qv35kumn9wgs8gmm0yyxqyjw5qcqp2sp5kj4xhrthmfgcgyl84zaqpl9vvdjwm5x368kr09fu5nym74setw4s9qy9qsq8hxjr73ee77vat0ay603e4w9aa8ag9sa2n55xznk5lsfrjffxxdj2k0wznvcfa98l4a57s80j7dhg0cc03vwqdwehkujlzxgm0xyynqqslwhvl
{
   &quot;code&quot;: 210,
   &quot;message&quot;: &quot;Ran out of routes to try after 11 attempts: see `paystatus`&quot;,
   &quot;attempts&quot;: [
      {
         &quot;status&quot;: &quot;failed&quot;,
         &quot;failreason&quot;: &quot;Error computing a route to 02f3d74746934494fa378235e5bc44cfdbb5b8779d839263fb7f9218be032f6f61: \&quot;Could not find a route\&quot; (205)&quot;,
         &quot;partid&quot;: 1,
         &quot;amount&quot;: &quot;11111msat&quot;
      },
...</code></pre>
<p>But what if a host that you had a channel with opened a channel with
the intended recipient?</p>
<p>In that case, when you go to pay the invoice, it will
<em>automatically work</em>!</p>
<pre><code>c$ lightning-cli --testnet pay lntb111110p1p0cw43ppp5u0ngjytlw6ywec3x784jale4xd7h058g9u4mthcaf9rl2f7g8zxsdp2t9hh2gr0wajjqmt9ypnx7u3qv35kumn9wgs8gmm0yyxqyjw5qcqp2sp5kj4xhrthmfgcgyl84zaqpl9vvdjwm5x368kr09fu5nym74setw4s9qy9qsq8hxjr73ee77vat0ay603e4w9aa8ag9sa2n55xznk5lsfrjffxxdj2k0wznvcfa98l4a57s80j7dhg0cc03vwqdwehkujlzxgm0xyynqqslwhvl
{
   &quot;destination&quot;: &quot;02f3d74746934494fa378235e5bc44cfdbb5b8779d839263fb7f9218be032f6f61&quot;,
   &quot;payment_hash&quot;: &quot;e3e689117f7688ece226f1eb2eff35337d77d0e82f2bb5df1d4947f527c8388d&quot;,
   &quot;created_at&quot;: 1602709081.324,
   &quot;parts&quot;: 1,
   &quot;msatoshi&quot;: 11111,
   &quot;amount_msat&quot;: &quot;11111msat&quot;,
   &quot;msatoshi_sent&quot;: 12111,
   &quot;amount_sent_msat&quot;: &quot;12111msat&quot;,
   &quot;payment_preimage&quot;: &quot;ec7d1b28a7b877cd92b83be396899e8bfc3ecb0b4f944f65afb4be7d0ee72617&quot;,
   &quot;status&quot;: &quot;complete&quot;
}</code></pre>
<p>That’s the true beauty of the Lightning Network there: with no effort
from the peer-to-peer participants, their individual channels become a
network!</p>
<blockquote>
<p>:book: <strong><em>How Do Payments Work Across the
Network?</em></strong> Say that node A has a channel open with node B,
node B has a channel open with node C, and node A receives an invoice
from node C for 11,111 msat. Node A pays node B the 11,111 msat, plus a
small fee, and then node B pays the 11,111 msat to node C. Easy enough.
Except remember that all channels actually are just records of who owns
how much of the Funding Transaction. So what really happens is 11,111
msat of the Funding Transaction on channel A-B shifts from A to B, and
then 11,111 msat of the Funding Transaction on channel B-C shifts from B
to C. This means that two things are required for this payment to work:
first, each channel must have sufficient capacity for the payment; and
second, the payer on each channel must own enough of the capacity to
make the payment.</p>
</blockquote>
<p>Note that in this example, 12,111 msat were sent to pay an invoice of
11,111 msat: the extra being a very small, flat fee (not a percentage)
that was paid to the intermediary.</p>
<h2 id="check-your-balance-1">Check your Balance</h2>
<p>Having successfully made a payment, you should see that your funds
have changed accordingly.</p>
<p>Here’s what funds looked like for the paying node following the
initial payment of 10,000 satoshis:</p>
<pre><code>c$ lightning-cli --testnet listfunds
{
   &quot;outputs&quot;: [
      {
         &quot;txid&quot;: &quot;66694d23ca15efe379e5f4a71d9be1a2d65e383b89ee3abe126ee36a12f23c1d&quot;,
         &quot;output&quot;: 1,
         &quot;value&quot;: 99847,
         &quot;amount_msat&quot;: &quot;99847000msat&quot;,
         &quot;scriptpubkey&quot;: &quot;00142fe02e5be9283e8c5bcb93ae61421baf8cb64f9c&quot;,
         &quot;address&quot;: &quot;tb1q9lszuklf9qlgck7tjwhxzssm47xtvnuu4jslf8&quot;,
         &quot;status&quot;: &quot;confirmed&quot;,
         &quot;blockheight&quot;: 1862856,
         &quot;reserved&quot;: false
      }
   ],
   &quot;channels&quot;: [
      {
         &quot;peer_id&quot;: &quot;032a7572dc013b6382cde391d79f292ced27305aa4162ec3906279fc4334602543&quot;,
         &quot;connected&quot;: true,
         &quot;state&quot;: &quot;CHANNELD_NORMAL&quot;,
         &quot;short_channel_id&quot;: &quot;1862856x29x0&quot;,
         &quot;channel_sat&quot;: 90000,
         &quot;our_amount_msat&quot;: &quot;90000000msat&quot;,
         &quot;channel_total_sat&quot;: 100000,
         &quot;amount_msat&quot;: &quot;100000000msat&quot;,
         &quot;funding_txid&quot;: &quot;66694d23ca15efe379e5f4a71d9be1a2d65e383b89ee3abe126ee36a12f23c1d&quot;,
         &quot;funding_output&quot;: 0
      }
   ]
}</code></pre>
<p>Note that the channel capacity remains at 100,000 satoshis (it never
changes!), but that <code>our_amount</code> is now just 90,000 satoshis
(or 90,000,000 msat).</p>
<p>After paying the second invoice, for 11,111 msat, the funds change
again accordingly:</p>
<pre><code>$ lightning-cli --testnet listfunds
{
   &quot;outputs&quot;: [
      {
         &quot;txid&quot;: &quot;66694d23ca15efe379e5f4a71d9be1a2d65e383b89ee3abe126ee36a12f23c1d&quot;,
         &quot;output&quot;: 1,
         &quot;value&quot;: 99847,
         &quot;amount_msat&quot;: &quot;99847000msat&quot;,
         &quot;scriptpubkey&quot;: &quot;00142fe02e5be9283e8c5bcb93ae61421baf8cb64f9c&quot;,
         &quot;address&quot;: &quot;tb1q9lszuklf9qlgck7tjwhxzssm47xtvnuu4jslf8&quot;,
         &quot;status&quot;: &quot;confirmed&quot;,
         &quot;blockheight&quot;: 1862856,
         &quot;reserved&quot;: false
      }
   ],
   &quot;channels&quot;: [
      {
         &quot;peer_id&quot;: &quot;032a7572dc013b6382cde391d79f292ced27305aa4162ec3906279fc4334602543&quot;,
         &quot;connected&quot;: true,
         &quot;state&quot;: &quot;CHANNELD_NORMAL&quot;,
         &quot;short_channel_id&quot;: &quot;1862856x29x0&quot;,
         &quot;channel_sat&quot;: 89987,
         &quot;our_amount_msat&quot;: &quot;89987000msat&quot;,
         &quot;channel_total_sat&quot;: 100000,
         &quot;amount_msat&quot;: &quot;100000000msat&quot;,
         &quot;funding_txid&quot;: &quot;66694d23ca15efe379e5f4a71d9be1a2d65e383b89ee3abe126ee36a12f23c1d&quot;,
         &quot;funding_output&quot;: 0
      }
   ]
}</code></pre>
<p><code>our_amount</code> is now just 89,987 satoshis, having paid
11,111 msat plus a 1,000 msat fee.</p>
<h2 id="summary-paying-a-invoice">Summary: Paying a Invoice</h2>
<p>Once you’ve got an invoice, it’s easy enough to pay with a single
command in Lightning. Even if you don’t have a channel to a recipient,
payment is that simple, provided that there’s a route between you and
the destination node.</p>
<h2 id="whats-next">What’s Next?</h2>
<p>Continue “Using Lighting” with <a
href="20_3_Closing_a_Channel.md">§20.3: Closing a Channel</a>.</p>
</body>
</html>
