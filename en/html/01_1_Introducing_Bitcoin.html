<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>01_1_Introducing_Bitcoin</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<h1 id="interlude-introducing-bitcoin">Interlude: Introducing
Bitcoin</h1>
<p>Before you can get started programming Bitcoin (and Lightning), you
should have a basic understanding of what they are and how they work.
This section provides that overview. Many more definitions will appear
within the document itself; this is only intended to lay the
foundation.</p>
<h2 id="about-bitcoin">About Bitcoin</h2>
<p>Bitcoin is a programmatic system that allows for the transfer of the
bitcoin currency. It is enabled by a decentralized, peer-to-peer system
of nodes, which include full nodes, wallets, and miners. Working
together, they ensure that bitcoin transactions are fast and
non-repudiable. Thanks to the decentralized nature of the system, these
transactions are also censor-resistant and can provide other advantages
such as pseudonymity and non-correlation if used well.</p>
<p>Obviously, Bitcoin is the heart of this book, but it’s also the
originator of many other systems, including blockchains and Lightning,
which are both detailed in this tutorial, and many other
cryptocurrencies such as Ethereum and Litecoin, which are not.</p>
<p><strong><em>How Are Coins Transferred?</em></strong> Bitcoin currency
isn’t physical coins. Instead it’s an endless series of ownership
reassignments. When one person sends coins to another, that transfer is
stored as a transaction. It’s the transaction that actually records the
ownership of the money, not any token local to the owner’s wallet or
their machine.</p>
<p><strong><em>Who Can You Send Coins To?</em></strong> The vast
majority of bitcoin transactions involve coins being sent to individual
people (or at least to individual Bitcoin addresses). However, more
complex methodologies can be used to send bitcoins to groups of people
or to scripts. These various methodologies have names like P2PKH,
multisig, and P2SH.</p>
<p><strong><em>How Are Transactions Stored?</em></strong> Transactions
are combined into larger blocks of data, which are then written to the
blockchain ledger. A block is built in such a way that it cannot be
replaced or rewritten once several blocks have been built atop
(following) it. This is what makes bitcoins non-repudiable: the
decentralized global ledger where everything is recorded is effectively
a permanent and unchangeable database.</p>
<p>However, the process of building these blocks is stochastic: it’s
somewhat random, so you can never be assured that a transaction will be
placed in a specific block. There can also be changes in blocks if
they’re very recent, but only if they’re <em>very</em> recent. So,
things become non-repudiable (and permanent and unchangeable) after a
little bit of time.</p>
<p><strong><em>How Are Transactions Protected?</em></strong> The funds
contained in a Bitcoin transaction are locked with a cryptographic
puzzle. These puzzles are designed so that they can be easily solved by
the person who the funds were sent to. This is done using the power of
public-key cryptography. Technically, a transaction is protected by a
signature that proves you’re the owner of the public key that a
transaction was sent to: this proof of ownership is the puzzle that’s
being solved.</p>
<p>Funds are further protected by the use of hashes. Public keys aren’t
actually stored in the blockchain until the funds are spent: only
public-key hashes are. This means that even if quantum computer were to
come along, Bitcoin transactions would remain protected by this second
level of cryptography.</p>
<p><strong><em>How Are Transactions Created?</em></strong> The heart of
each Bitcoin transaction is a FORTH-like scripting language that is used
to lock the transaction. To respend the money, the recipient provides
specific information to the script that proves he’s the intended
recipient.</p>
<p>However, these Bitcoin scripts are the lowest level of Bitcoin
functionality. Much Bitcoin work is done through the
<code>bitcoind</code> Bitcoin daemon, which is controlled through RPC
commands. Many people send those RPC commands through the
<code>bitcoin-cli</code> program, which provides an even simpler
interface. Non-programmers don’t even worry about these minutia, but
instead use programmed wallets with simpler interfaces.</p>
<h3 id="bitcoin-in-short">Bitcoin — In Short</h3>
<p>One way to think of Bitcoin is as <em>a sequence of atomic
transactions</em>. Each transaction is authenticated by a sender with
the solution to a previous cryptographic puzzle that was stored as a
script. The new transaction is locked for the recipient with a new
cryptographic puzzle that is also stored as a script. Every transaction
is recorded in an immutable global ledger.</p>
<h2 id="about-public-key-cryptography">About Public-Key
Cryptography</h2>
<p>Public-key cryptography is a mathematical system for protecting data
and proving ownership through an asymmetric pair of linked keys: the
public key and the private key.</p>
<p>It’s important to Bitcoin (and to most blockchain systems) because
it’s the basis of a lot of the cryptography that protects the
cryptocurrency funds. A Bitcoin transaction is typically sent to an
address that is a hashed public key. The recipient is then able to
retrieve the money by revealing both the public key and the private
key.</p>
<p><strong><em>What Is a Public Key?</em></strong> A public key is the
key given out to other people. In a typical public-key system, a user
generates a public key and a private key, then he gives the public key
to all and sundry. Those recipients can encrypt information with the
public key, but it can’t be decrypted with the same public key because
of the asymmetry of the key pair.</p>
<p><strong><em>What Is a Private Key?</em></strong> A private key is
linked to a public key in a key pair. In a typical public-key system, a
user keeps his private key secure and uses it to decrypt messages that
were encrypted with his public key before being sent to him.</p>
<p><strong><em>What Is a Signature?</em></strong> A message (or more
commonly, a hash of a message) can be signed with a private key,
creating a signature. Anyone with the corresponding public key can then
validate the signature, which verifies that the signer owns the private
key associated with the public key in question. <em>SegWit</em> is a
specific format for storing a signature on the Bitcoin network that
we’ll meet down the line.</p>
<p><strong><em>What Is a Hash Function?</em></strong> A hash function is
an algorithm frequently used with cryptography. It’s a way to map a
large, arbitrary amount of data to a small, fixed amount of data. Hash
functions used in cryptography are one-way and collision-resistant,
meaning that a hash can reliably be linked to the original data, but the
original data can not be regenerated from the hash. Hashes thus allow
the transmission of small amounts of data to represent large amounts of
data, which can be important for efficiency and storage
requirements.</p>
<p>Bitcoin takes advantage of a hash’s ability to disguise the original
data, which allows concealment of a user’s actual public key, making
transactions resistant to quantum computing.</p>
<h3 id="public-key-cryptography-in-short">Public-Key Cryptography — In
Short</h3>
<p>One way to think of public-key cryptography is: <em>a way for anyone
to protect data such that only an authorized person can access it, and
such that the authorized person can prove that he will have that
access.</em></p>
<h2 id="about-ecc">About ECC</h2>
<p>ECC stands for elliptic-curve cryptography. It’s a specific branch of
public-key cryptography that depends on mathematical calculations
conducted using elliptic curves defined over finite fields. It’s more
complex and harder to explain than classic public-key cryptography
(which used prime numbers), but it has some nice advantages.</p>
<p>ECC does not receive much attention in this tutorial. That’s because
this tutorial is all about integrating with Bitcoin Core and Lightning
servers, which have already taken care of the cryptography for you. In
fact, this tutorial’s intention is that you don’t have to worry about
cryptography at all, because that’s something that you <em>really</em>
want experts to deal with.</p>
<p><strong><em>What is an Elliptic Curve?</em></strong> An elliptic
curve is a geometric curve that takes the form
<code>y</code><sup><code>2</code></sup> =
<code>x</code><sup><code>3</code></sup><code>+ ax + b</code>. A specific
elliptic curve is chosen by selecting specific values of <code>a</code>
and <code>b</code>. The curve must then be carefully examined to
determine if it works well for cryptography. For example, the secp256k1
curve used by Bitcoin is defined as <code>a=0</code> and
<code>b=7</code>.</p>
<p>Any line that intersects an elliptic curve will do so at either 1 or
3 points … and that’s the basis of elliptic-curve cryptography.</p>
<p><strong><em>What are Finite Fields?</em></strong> A finite field is a
finite set of numbers, where all addition, subtraction, multiplication,
and division is defined so that it results in other numbers also in the
same finite field. One simple way to create a finite field is through
the use of a modulo function.</p>
<p><strong><em>How is an Elliptic Curve Defined Over a Finite
Field?</em></strong> An elliptic curve defined over a finite field has
all of the points on its curve drawn from a specific finite field. This
takes the form: <code>y</code><sup><code>2</code></sup>
<code>% field-size = (x</code><sup><code>3</code></sup><code>+ ax + b) % field-size</code>
The finite field used for secp256k1 is
<code>2</code><sup><code>256</code></sup><code>- 2</code><sup><code>32</code></sup><code>- 2</code><sup><code>9</code></sup><code>- 2</code><sup><code>8</code></sup><code>- 2</code><sup><code>7</code></sup><code>- 2</code><sup><code>6</code></sup><code>- 2</code><sup><code>4</code></sup><code>- 1</code>.</p>
<p><strong><em>How Are Elliptic Curves Used in
Cryptography?</em></strong> In elliptic-curve cryptography, a user
selects a very large (256-bit) number as his private key. He then adds a
set base point on the curve to itself that many times. (In secp256k1,
the base point is
<code>G = 04 79BE667E F9DCBBAC 55A06295 CE870B07 029BFCDB 2DCE28D9 59F2815B 16F81798 483ADA77 26A3C465 5DA4FBFC 0E1108A8 FD17B448 A6855419 9C47D08F FB10D4B8</code>,
which prefixes the two parts of the tuple with an <code>04</code> to say
that the data point is in uncompressed form. If you prefer a straight
geometric definition, it’s the point
“0x79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798,0x483ADA7726A3C4655DA4FBFC0E1108A8FD17B448A68554199C47D08FFB10D4B8”)
The resultant number is the public key. Various mathematical formula can
then be used to prove ownership of the public key, given the private
key. As with any cryptographic function, this one is a trap door: it’s
easy to go from private key to public key and largely impossible to go
from public key to private key.</p>
<p>This particular methodology also explains why finite fields are used
in elliptic curves: it ensures that the private key will not grow too
large. Note that the finite field for secp256k1 is slightly smaller than
256 bits, which means that all public keys will be 256 bits long, just
like the private keys are.</p>
<p><strong><em>What Are the Advantages of ECC?</em></strong> The main
advantage of ECC is that it allows the same security as classic
public-key cryptography with a much smaller key. A 256-bit
elliptic-curve public key corresponds to a 3072-bit traditional (RSA)
public key.</p>
<h3 id="ecc---in-short">ECC - In Short</h3>
<p>One way to think of ECC is: <em>a way to enable public-key
cryptography that uses very small keys and very obscure math.</em></p>
<h2 id="about-blockchains">About Blockchains</h2>
<p>Blockchain is the generalization of the methodology used by Bitcoin
to create a distributed global ledger. Bitcoin is a blockchain as are
any number of alt-coins, each of which lives on its own network and
writes to its own chain. Sidechains like Liquid are blockchains too.
Blockchains don’t even need to have anything to do with finances. For
example, there have been many discussions of using blockchains to
protect self-sovereign identities.</p>
<p>Though you need to understand the basics of how a blockchain works to
understand how transactions work in Bitcoin, you won’t need to go any
further than that. Because blockchains have become a wide category of
technology, those basic concepts are likely to be applicable to many
other projects in this growing technology sector. The specific
programming commands learned in this book will not be, however, as
they’re fairly specific to Bitcoin (and Lightning).</p>
<p><strong><em>Why Is It Called a Chain?</em></strong> Each block in the
blockchain stores a hash of the block before it. This links the current
block all the way back to the original “genesis block” through an
unbroken chain. It’s a way to create absolute order among possibly
conflicting data. This also provides the security of blockchain, because
each block is stacked atop an old one makes it harder to recreate the
old block due to the proof-of-work algorithms used in block creation.
Once several blocks have been built atop a block in the chain, it’s
essentially irreversible.</p>
<p><strong><em>What is a Fork?</em></strong> Occasionally two blocks are
created around the same time. This temporarily creates a one-block fork,
where either if the current blocks could be the “real” one. Every once
in a while, a fork might expand to become two blocks, three blocks, or
even four blocks long, but pretty quickly one side of the fork is
determined to be the real one, and the other is “orphaned”. This is part
of the stochastic process of block creation, and demonstrates why
several blocks must be built atop a block before it can be considered
truly trustworthy and non-repudiable.</p>
<h3 id="blockchain-in-short">Blockchain — In Short</h3>
<p>One way to think of blockchain is: <em>a linked series of blocks of
unchangeable data, going back in time</em>. Another way is: <em>a linked
series of blocks to absolutely order data that could be
conflicting</em>.</p>
<h2 id="is-blockchain-right-for-me">Is Blockchain Right for Me?</h2>
<p>If you want to transact bitcoins, then obviously Bitcoin is right for
you. However, more widely, blockchain has become a popular buzz-word
even though it’s not a magic bullet for all technical problems. With
that said, there are many specific situations where blockchain is a
superior technology.</p>
<p>Blockchains probably <em>will</em> be helpful if:</p>
<ul>
<li>Users don’t trust each other.
<ul>
<li>Or: Users exist across various borders.</li>
</ul></li>
<li>Users don’t trust central authorities.
<ul>
<li>And: Users want to control their own destinies.</li>
</ul></li>
<li>Users want transparent technology.</li>
<li>Users want to share something.
<ul>
<li>And: Users want what’s shared to be permanently recorded.</li>
</ul></li>
<li>Users want fast transaction finality.
<ul>
<li>But: Users don’t need instant transaction finality.</li>
</ul></li>
</ul>
<p>Blockchains probably <em>will not</em> be helpful if:</p>
<ul>
<li>Users are trusted:
<ul>
<li>e.g.: transactions occur within a business or organization.</li>
<li>e.g.: transactions are overseen by a central authority.</li>
</ul></li>
<li>Secrecy is required:
<ul>
<li>e.g.: Information should be secret.</li>
<li>e.g.: Transactions should be secret.</li>
<li>e.g.: Transactors should be secret.</li>
<li>Unless: A methodology for cryptographic secrecy is carefully
considered, analyzed, and tested.</li>
</ul></li>
<li>Users need instant transaction finality.
<ul>
<li>e.g.: in less than 10 minutes on a Bitcoin-like network, in less
than 2.5 minutes on a Litecoin-like network, in less than 15 seconds on
an Ethereum-like network</li>
</ul></li>
</ul>
<p>Do note that there may still be solutions for some of these
situations within the Bitcoin ecosystem. For example, payment channels
are rapidly addressing questions of liquidity and payment finality.</p>
<h2 id="about-lightning">About Lightning</h2>
<p>Lightning is a layer-2 protocol that interacts with Bitcoin to allow
users to exchange their bitcoins “off-chain”. It has both advantages and
disadvantages over using Bitcoin on its own.</p>
<p>Lightning is also the secondary focus of this tutorial. Though it’s
mostly about interacting directly with Bitcoin (and the
<code>bitcoind</code>), it pays some attention to Lightning because it’s
an upcoming technology that is likely to become a popular alternative to
Bitcoin in the near future. This book takes the same approach to
Lightning as to Bitcoin: it teaches how to interact directly with a
trusted Lightning daemon from the command line.</p>
<p>Unlike with Bitcoin, there are actually several variants of
Lightning. This tutorial uses the standard-compliant <a
href="https://github.com/ElementsProject/lightning">c-lightning</a>
implementation as its trusted Lightning server.</p>
<p><strong><em>What is a Layer-2 Protocol?</em></strong> A layer-2
Bitcoin protocol works on top of Bitcoin. In this case, Lightning works
atop Bitcoin, interacting with it through smart contracts.</p>
<p><strong><em>What is a Lightning Channel?</em></strong> A Lightning
Channel is a connection between two Lightning users. Each of the users
locks up some number of bitcoins on the Bitcoin blockchain using a
multi-sig signed by both of them. The two users can then exchange
bitcoins through their Lightning channel without ever writing to the
Bitcoin blockchain. Only when they want to close out their channel do
they settle their bitcoins, based on the final division of coins.</p>
<p><strong><em>What is a Lightning Network?</em></strong> Putting
together a number of Lightning Channels creates the Lightning Network.
This allows two users who have not created a channel between themselves
to exchange bitcoins using Lightning: the protocol forms a chain of
Channels between the two users, then exchanges the coins through the
chain using time-locked transactions.</p>
<p><strong><em>What are the Advantages of Lightning?</em></strong>
Lightning allows for faster transactions with lower fees. This creates
the real possibility of bitcoin-funded micropayments. It also offers
better privacy, since it’s off-chain with only the first and last states
of the transaction being written to the immutable Bitcoin ledger.</p>
<p><strong><em>What are the Disadvantages of Lightning?</em></strong>
Lightning is still a very new technology and hasn’t been tested as
thoroughly as Bitcoin. That’s not just a question of the technological
implementation, but also whether the design itself can be gamed in any
unexpected ways.</p>
<h3 id="lightning---in-short">Lightning - In Short</h3>
<p>One way to think of Lightning is: <em>a way to transact bitcoins
using off-chain channels between pairs of people, so that only a first
and final state have to be written to the blockchain</em>.</p>
<h2 id="summary-introducing-bitcoin">Summary: Introducing Bitcoin</h2>
<p>Bitcoin is a peer-to-peer system that allows for the transfer of
funds through transactions that are locked with puzzles. These puzzles
are dependent upon public-key elliptic-curve cryptography. When you
generalize the ideas behind Bitcoin, you get blockchains, a technology
that’s currently growing and innovating. When you expand the ideas
behind Bitcoin, you get layer-2 protocols such as Lightning, which
expand the currency’s potential.</p>
<h2 id="whats-next">What’s Next?</h2>
<p>Advance through “Preparing for Bitcoin” with <a
href="02_0_Setting_Up_a_Bitcoin-Core_VPS.md">Chapter Two: Setting Up a
Bitcoin-Core VPS</a>.</p>
</body>
</html>
